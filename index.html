<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AISH Health Monitoring System - MongoDB Edition</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', sans-serif;
      background: #f8f9fa;
      color: #2c3e50;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideInRight { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes sparkle { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
    @keyframes bounce { 0%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-10px); } }
    
    header {
      background: #ffffff;
      border-bottom: 1px solid #e9ecef;
      padding: 20px 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    
    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .logo-icon {
      width: 48px;
      height: 48px;
      border: 2px solid #3498db;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      animation: pulse 3s ease-in-out infinite;
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
    }
    
    .logo-text h1 {
      font-family: 'Poppins', sans-serif;
      font-size: 28px;
      font-weight: 700;
      color: #2c3e50;
      letter-spacing: 1px;
    }
    
    .logo-text p {
      color: #7f8c8d;
      font-size: 12px;
      margin-top: 4px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 500;
    }
    
    .status {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 20px;
      background: #e8f5e9;
      border-radius: 8px;
      border: 1px solid #81c784;
    }
    
    .status.offline {
      background: #ffebee;
      border-color: #e57373;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      background: #4caf50;
      border-radius: 50%;
      animation: pulse 1s infinite;
    }
    
    .status-dot.offline {
      background: #e74c3c;
    }
    
    .status-text {
      font-family: 'Poppins', sans-serif;
      font-size: 11px;
      font-weight: 600;
      color: #2e7d32;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .status-text.offline {
      color: #c62828;
    }
    
    .download-btn {
      padding: 10px 20px;
      background: #27ae60;
      color: white;
      border: none;
      border-radius: 8px;
      font-family: 'Poppins', sans-serif;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .download-btn:hover {
      background: #229954;
      box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
      transform: translateY(-2px);
    }
    
    .user-badge {
      padding: 10px 20px;
      background: #e3f2fd;
      border: 1px solid #90caf9;
      border-radius: 8px;
      font-family: 'Poppins', sans-serif;
      font-size: 11px;
      font-weight: 600;
      color: #1976d2;
      display: none;
      align-items: center;
      gap: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    nav {
      max-width: 1600px;
      margin: 24px auto 0;
      padding: 0 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .nav-btn {
      font-family: 'Poppins', sans-serif;
      padding: 12px 24px;
      background: #ffffff;
      color: #546e7a;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-weight: 600;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .nav-btn.active {
      background: #3498db;
      border-color: #3498db;
      color: white;
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }
    
    .nav-btn:hover:not(.active) {
      background: #f5f5f5;
      border-color: #3498db;
      color: #3498db;
    }
    
    main {
      max-width: 1600px;
      margin: 24px auto 0;
      padding: 0 24px 40px;
    }
    
    .jarvis-panel {
      background: #ffffff;
      border: 1px solid #e9ecef;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      border-radius: 12px;
      padding: 28px;
      animation: slideIn 0.6s ease-out;
      position: relative;
      margin-bottom: 20px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }
    
    .stat-card {
      border-left: 3px solid #3498db;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      transition: all 0.4s ease;
      position: relative;
      padding-left: 20px;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      border-left-color: #27ae60;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .stat-label {
      font-family: 'Poppins', sans-serif;
      color: #7f8c8d;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 10px;
      letter-spacing: 2px;
    }
    
    .stat-value {
      font-family: 'Poppins', sans-serif;
      font-size: 42px;
      font-weight: 700;
      color: #2c3e50;
      line-height: 1;
    }
    
    .stat-icon {
      font-size: 40px;
      opacity: 0.3;
      color: #3498db;
    }
    
    .stat-subtext {
      color: #95a5a6;
      font-size: 12px;
      margin-top: 8px;
      font-weight: 500;
    }
    
    h2 {
      font-family: 'Poppins', sans-serif;
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 20px;
      color: #2c3e50;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    
    .section-hidden { display: none; }
    .section-visible { display: block; }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active { display: flex; }
    
    .modal-content {
      max-width: 600px;
      width: 90%;
      animation: slideIn 0.6s ease-out;
    }
    
    .character-select {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }
    
    .character-card {
      background: #ffffff;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .character-card:hover {
      border-color: #3498db;
      box-shadow: 0 4px 16px rgba(52, 152, 219, 0.2);
      transform: translateY(-4px);
    }
    
    .character-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }
    
    .character-name {
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      color: #2c3e50;
      margin-bottom: 8px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .character-desc {
      font-size: 12px;
      color: #7f8c8d;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      color: #546e7a;
      margin-bottom: 8px;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    input, select {
      width: 100%;
      padding: 12px 16px;
      background: #f8f9fa;
      color: #2c3e50;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    input::placeholder {
      color: #adb5bd;
    }
    
    input:focus, select:focus {
      background: #ffffff;
      border-color: #3498db;
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    
    .jarvis-btn {
      font-family: 'Poppins', sans-serif;
      padding: 14px 28px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    
    .jarvis-btn:hover:not(:disabled) {
      background: #2980b9;
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
      transform: translateY(-2px);
    }
    
    .jarvis-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .jarvis-btn-secondary {
      background: #27ae60;
      color: white;
    }
    
    .jarvis-btn-secondary:hover:not(:disabled) {
      background: #229954;
      box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
    }

    .jarvis-btn-danger {
      background: #e74c3c;
      color: white;
      padding: 8px 16px;
      font-size: 10px;
    }

    .jarvis-btn-danger:hover:not(:disabled) {
      background: #c0392b;
      box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
    }
    
    .symptom-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .symptom-btn {
      font-family: 'Inter', sans-serif;
      padding: 12px 16px;
      border-radius: 8px;
      border: 2px solid #e9ecef;
      background: #ffffff;
      color: #546e7a;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .symptom-btn.selected {
      border-color: #27ae60;
      background: #e8f5e9;
      color: #27ae60;
    }
    
    .symptom-btn:hover:not(.selected) {
      background: #f8f9fa;
      border-color: #3498db;
      color: #3498db;
    }
    
    .notification {
      position: fixed;
      top: 100px;
      right: 24px;
      background: #ffffff;
      padding: 16px 24px;
      border-radius: 8px;
      border: 1px solid #e9ecef;
      color: #2c3e50;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 12px;
      animation: slideInRight 0.4s ease;
      z-index: 1000;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .notification.success {
      background: #e8f5e9;
      border-color: #81c784;
      color: #2e7d32;
    }
    
    .notification.error {
      background: #ffebee;
      border-color: #e57373;
      color: #c62828;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    th {
      font-family: 'Poppins', sans-serif;
      padding: 14px;
      text-align: left;
      font-size: 11px;
      font-weight: 700;
      color: #546e7a;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 2px solid #e9ecef;
      background: #f8f9fa;
    }
    
    td {
      padding: 14px;
      border-bottom: 1px solid #f1f3f5;
      color: #2c3e50;
      font-size: 13px;
    }
    
    tr:hover {
      background: #f8f9fa;
    }
    
    .symptom-badge {
      display: inline-block;
      padding: 4px 10px;
      background: #e3f2fd;
      color: #1976d2;
      border-radius: 6px;
      margin-right: 6px;
      font-size: 10px;
      font-weight: 600;
      border: 1px solid #90caf9;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .severity-badge {
      font-family: 'Poppins', sans-serif;
      display: inline-block;
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 10px;
      border: 2px solid;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .severity-high {
      background: #ffebee;
      color: #c62828;
      border-color: #e57373;
    }
    
    .severity-medium {
      background: #fff3e0;
      color: #e65100;
      border-color: #ffb74d;
    }
    
    .severity-low {
      background: #e8f5e9;
      color: #2e7d32;
      border-color: #81c784;
    }
    
    #map {
      height: 400px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border: 1px solid #e9ecef;
    }
    
    .location-detect-btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    
    .location-detect-btn:hover {
      background: #2980b9;
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }
    
    .location-detect-btn:disabled {
      background: #95a5a6;
      cursor: not-allowed;
    }
    
    .location-info {
      background: #e3f2fd;
      padding: 12px;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 12px;
      border: 1px solid #90caf9;
      display: none;
    }
    
    .location-info.show {
      display: block;
    }
    
    .chart-container {
      position: relative;
      height: 300px;
      margin-top: 20px;
    }

    .error-msg {
      color: #e74c3c;
      background: #ffebee;
      padding: 12px;
      border-radius: 8px;
      font-size: 12px;
      margin-top: 12px;
      text-align: center;
      display: none;
      border: 1px solid #e57373;
    }

    .security-note {
      margin-top: 20px;
      padding: 20px;
      background: #fff3e0;
      border-left: 4px solid #f57c00;
      border-radius: 8px;
    }

    .security-note strong {
      color: #e65100;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
    }

    .security-note p {
      color: #7f8c8d;
      margin-top: 8px;
      font-size: 13px;
    }

    .ai-doctor-avatar {
      width: 120px;
      height: 120px;
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 64px;
      position: relative;
      animation: float 3s ease-in-out infinite;
      box-shadow: 0 8px 24px rgba(52, 152, 219, 0.3);
      border: 4px solid #ffffff;
    }
    
    .ai-doctor-avatar::before {
      content: '';
      position: absolute;
      width: 140px;
      height: 140px;
      border: 2px solid #e3f2fd;
      border-radius: 50%;
      animation: rotate 10s linear infinite;
      border-top-color: #3498db;
      border-right-color: transparent;
    }
    
    .ai-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      border-radius: 20px;
      font-family: 'Poppins', sans-serif;
      font-size: 11px;
      font-weight: 700;
      color: white;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }
    
    .ai-badge::before {
      content: '‚ö°';
      animation: sparkle 2s ease-in-out infinite;
    }
    
    .protocol-card {
      background: #ffffff;
      border: 1px solid #e9ecef;
      border-radius: 12px;
      padding: 24px;
      transition: all 0.4s ease;
      position: relative;
    }
    
    .protocol-card:hover {
      transform: translateY(-5px);
      border-color: #3498db;
      box-shadow: 0 8px 24px rgba(52, 152, 219, 0.15);
    }
    
    .protocol-card.do-card {
      border-left: 4px solid #27ae60;
    }
    
    .protocol-card.dont-card {
      border-left: 4px solid #e74c3c;
    }

    .language-selector {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .language-btn {
      font-family: 'Poppins', sans-serif;
      padding: 10px 20px;
      background: #ffffff;
      color: #546e7a;
      border: 2px solid #e9ecef;
      border-radius: 20px;
      font-weight: 600;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .language-btn:hover {
      border-color: #3498db;
      color: #3498db;
      transform: translateY(-2px);
    }
    
    .language-btn.active {
      background: #3498db;
      border-color: #3498db;
      color: white;
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }

    .ai-thinking {
      display: inline-flex;
      gap: 4px;
      margin-left: 8px;
    }
    
    .ai-thinking span {
      width: 6px;
      height: 6px;
      background: #3498db;
      border-radius: 50%;
      animation: bounce 1.4s ease-in-out infinite;
    }
    
    .ai-thinking span:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .ai-thinking span:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    /* Chatbot Styles */
    .chat-message {
      animation: slideIn 0.3s ease-out;
    }
    
    .bot-message {
      margin-bottom: 16px;
      padding: 16px;
      background: white;
      border-radius: 12px;
      border-left: 4px solid #3498db;
    }
    
    .user-message {
      margin-bottom: 16px;
      padding: 16px;
      background: #e3f2fd;
      border-radius: 12px;
      border-left: 4px solid #2196f3;
      text-align: right;
    }
    
    .quick-topic-btn {
      padding: 8px 16px;
      background: white;
      color: #856404;
      border: 2px solid #ffc107;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }
    
    .quick-topic-btn:hover {
      background: #ffc107;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
    }
    
    #chatMessages::-webkit-scrollbar {
      width: 8px;
    }
    
    #chatMessages::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    #chatMessages::-webkit-scrollbar-thumb {
      background: #3498db;
      border-radius: 4px;
    }
    
    #chatMessages::-webkit-scrollbar-thumb:hover {
      background: #2980b9;
    }
    
    /* Floating Chatbot Styles */
    .chatbot-toggle {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      border-radius: 50%;
      border: none;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(52, 152, 219, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      transition: all 0.3s ease;
      z-index: 999;
      animation: float 3s ease-in-out infinite;
    }
    
    .chatbot-toggle:hover {
      transform: scale(1.1) translateY(-5px);
      box-shadow: 0 12px 32px rgba(52, 152, 219, 0.6);
    }
    
    .chatbot-toggle.active {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    }
    
    .chatbot-popup {
      position: fixed;
      bottom: 120px;
      right: 30px;
      width: 420px;
      max-height: 650px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      display: none;
      flex-direction: column;
      z-index: 998;
      animation: slideInRight 0.4s ease-out;
      overflow: hidden;
    }
    
    .chatbot-popup.active {
      display: flex;
    }
    
    .chatbot-header {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
      padding: 20px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 20px 20px 0 0;
    }
    
    .chatbot-header h3 {
      font-family: 'Poppins', sans-serif;
      font-size: 18px;
      font-weight: 700;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .chatbot-close {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .chatbot-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }
    
    .chatbot-body {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #f8f9fa;
    }
    
    .chatbot-footer {
      padding: 16px 20px;
      background: white;
      border-top: 1px solid #e9ecef;
    }

    /* Observer blocked message */
    .observer-blocked {
      text-align: center;
      padding: 60px 40px;
    }
    .observer-blocked .blocked-icon {
      font-size: 80px;
      margin-bottom: 20px;
    }
    .observer-blocked h3 {
      font-family: 'Poppins', sans-serif;
      font-size: 22px;
      color: #e74c3c;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    .observer-blocked p {
      color: #7f8c8d;
      font-size: 14px;
      margin-bottom: 24px;
      line-height: 1.6;
    }
    
    @media (max-width: 768px) {
      .stats-grid, .character-select { grid-template-columns: 1fr; }
      .symptom-grid { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); }
      .header-content { flex-direction: column; text-align: center; }
      nav { overflow-x: auto; flex-wrap: nowrap; }
      #map { height: 300px; }
      .logo-text h1 { font-size: 24px; }
      .ai-doctor-avatar { width: 80px; height: 80px; font-size: 48px; }
      .ai-doctor-avatar::before { width: 100px; height: 100px; }
      #chatMessages { height: 300px; }
      
      .chatbot-popup {
        width: calc(100vw - 40px);
        right: 20px;
        bottom: 100px;
        max-height: 500px;
      }
      
      .chatbot-toggle {
        width: 60px;
        height: 60px;
        font-size: 30px;
        bottom: 20px;
        right: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Login Modal -->
  <div id="loginModal" class="modal active">
    <div class="modal-content">
      <div class="jarvis-panel">
        <h2 style="font-size: 24px; margin-bottom: 10px; text-align: center;">üîí SYSTEM ACCESS REQUIRED</h2>
        <p style="color: #7f8c8d; font-size: 14px; margin-bottom: 32px; text-align: center;">Select your access level to continue</p>
        
        <div class="character-select" id="characterSelect">
          <div class="character-card" data-role="doctor">
            <div class="character-icon">‚öïÔ∏è</div>
            <div class="character-name">Medical Officer</div>
            <div class="character-desc">Healthcare provider access</div>
          </div>
          
          <div class="character-card" data-role="viewer">
            <div class="character-icon">üëÅÔ∏è</div>
            <div class="character-name">Observer</div>
            <div class="character-desc">Read-only monitoring</div>
          </div>
          
          <div class="character-card" data-role="admin">
            <div class="character-icon">‚öôÔ∏è</div>
            <div class="character-name">Administrator</div>
            <div class="character-desc">Full system control</div>
          </div>
        </div>
        
        <!-- Doctor Login Form -->
        <div id="doctorLoginForm" style="display: none; margin-top: 28px;">
          <button id="backBtnDoctor" class="jarvis-btn jarvis-btn-secondary" style="width: 100%; margin-bottom: 20px;">‚Üê Return to Selection</button>
          <div class="form-group">
            <label>‚öïÔ∏è Select Your Name</label>
            <select id="doctorSelect">
              <option value="">-- Select your name --</option>
            </select>
          </div>
          <div class="form-group">
            <label>üîê Password</label>
            <input type="password" id="doctorPassword" placeholder="Enter your password">
          </div>
          <div class="error-msg" id="doctorError">‚ùå Wrong password. Please try again.</div>
          <button class="jarvis-btn" id="doctorLoginBtn" style="width: 100%;">Authenticate</button>
          <p style="color: #95a5a6; font-size: 11px; margin-top: 14px; text-align: center;">
            Select your name from the list, then enter your password
          </p>
        </div>

        <!-- Admin Login Form -->
        <div id="adminLoginForm" style="display: none; margin-top: 28px;">
          <button id="backBtnAdmin" class="jarvis-btn jarvis-btn-secondary" style="width: 100%; margin-bottom: 20px;">‚Üê Return to Selection</button>
          <div class="form-group">
            <label>‚öôÔ∏è Admin Username</label>
            <input type="text" id="adminUsername" placeholder="Enter admin username">
          </div>
          <div class="form-group">
            <label>üîê Admin Password</label>
            <input type="password" id="adminPassword" placeholder="Enter admin password">
          </div>
          <div class="error-msg" id="adminError">‚ùå Invalid admin credentials. Access denied.</div>
          <button class="jarvis-btn" id="adminLoginBtn" style="width: 100%;">Authenticate</button>
        </div>
      </div>
    </div>
  </div>

  <header>
    <div class="header-content">
      <div class="logo">
        <div class="logo-icon">‚óà</div>
        <div class="logo-text">
          <h1>A.I.S.H</h1>
          <p>AI Health Monitoring System</p>
        </div>
      </div>
      <div class="status" id="systemStatus">
        <div class="status-dot" id="statusDot"></div>
        <div class="status-text" id="statusText">Connecting...</div>
      </div>
      <div class="user-badge" id="userBadge">
        <span id="userIcon">‚óâ</span>
        <span id="userName">User</span>
        <button id="switchRoleBtn" style="background: none; border: none; color: #3498db; cursor: pointer; font-size: 18px; margin-left: 8px;" title="Switch Role">‚ü≤</button>
        <button id="logoutBtn" style="background: none; border: none; color: #e74c3c; cursor: pointer; font-size: 18px; margin-left: 8px;" title="Logout">‚äó</button>
      </div>
      <button class="download-btn" onclick="downloadDashboard()">
        üìä Download Dashboard
      </button>
      <button class="download-btn" onclick="downloadRegistry()">
        üìã Download Registry
      </button>
    </div>
  </header>

  <nav>
    <button class="nav-btn active" data-tab="dashboard">‚óà Dashboard</button>
    <button class="nav-btn" data-tab="report" id="reportTabBtn">‚äï Report Case</button>
    <button class="nav-btn" data-tab="water">‚âã Water Sources</button>
    <button class="nav-btn" data-tab="analytics">‚ó¨ Analytics</button>
    <button class="nav-btn" data-tab="protocols">‚öï Protocols</button>
    <button class="nav-btn" id="adminBtn" data-tab="admin" style="display: none;">‚öô Admin Panel</button>
  </nav>

  <main>
    <!-- Dashboard -->
    <div id="dashboard" class="section-visible">
      <div class="stats-grid">
        <div class="jarvis-panel stat-card">
          <div>
            <div class="stat-label">Total Cases</div>
            <div class="stat-value" id="totalCases">24</div>
            <div class="stat-subtext"><span id="activeCases">8</span> currently active</div>
          </div>
          <div class="stat-icon">‚óà</div>
        </div>
        <div class="jarvis-panel stat-card">
          <div>
            <div class="stat-label">Critical Status</div>
            <div class="stat-value" id="criticalCases">6</div>
            <div class="stat-subtext">Immediate attention required</div>
          </div>
          <div class="stat-icon">‚ö†</div>
        </div>
        <div class="jarvis-panel stat-card">
          <div>
            <div class="stat-label">Recovered</div>
            <div class="stat-value" id="recoveredCases">14</div>
            <div class="stat-subtext">Treatment completed</div>
          </div>
          <div class="stat-icon">‚úì</div>
        </div>
        <div class="jarvis-panel stat-card">
          <div>
            <div class="stat-label">Affected Areas</div>
            <div class="stat-value" id="affectedAreas">4</div>
            <div class="stat-subtext">High-risk zones identified</div>
          </div>
          <div class="stat-icon">‚ñ£</div>
        </div>
      </div>

      <div class="jarvis-panel">
        <h2>Case Registry</h2>
        <table>
          <thead>
            <tr>
              <th>Patient</th>
              <th>Location</th>
              <th>Symptoms</th>
              <th>Severity</th>
              <th>Status</th>
              <th>Date</th>
              <th>Reported By</th>
              <th id="actionsHeader" style="display: none;">Actions</th>
            </tr>
          </thead>
          <tbody id="caseTableBody">
            <tr class="default-case">
              <td><strong>Priya</strong><br><span style="color: #95a5a6;">Age: 28</span></td>
              <td>Imphal</td>
              <td><span class="symptom-badge">Vomiting</span><span class="symptom-badge">Abdominal Pain</span></td>
              <td><span class="severity-badge severity-high">Critical</span></td>
              <td><span style="color: #e74c3c; font-weight: 700;">Active</span></td>
              <td>Oct 16</td>
              <td></td>
            </tr>
            <tr class="default-case">
              <td><strong>Lakshmi</strong><br><span style="color: #95a5a6;">Age: 31</span></td>
              <td>Aizawl</td>
              <td><span class="symptom-badge">Fever</span><span class="symptom-badge">Nausea</span></td>
              <td><span class="severity-badge severity-high">Critical</span></td>
              <td><span style="color: #e74c3c; font-weight: 700;">Active</span></td>
              <td>Oct 17</td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Report Case ‚Äî FIXED: shows blocked message for observers -->
    <div id="report" class="section-hidden">
      <!-- This content is replaced dynamically based on role -->
      <div id="reportFormContainer" style="max-width: 900px; margin: 0 auto;">
        <div class="jarvis-panel">
          <h2 style="font-size: 24px; margin-bottom: 10px;">‚äï New Case Report</h2>
          <p style="color: #7f8c8d; margin-bottom: 16px; font-size: 13px;">Enter patient information and symptoms</p>
          
          <form id="reportForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <div class="form-group">
                <label>Patient Name *</label>
                <input type="text" id="patientName" required placeholder="Enter full name">
              </div>
              <div class="form-group">
                <label>Age *</label>
                <input type="number" id="patientAge" required placeholder="Age" min="0" max="120">
              </div>
            </div>
            <div class="form-group">
              <label>Location *</label>
              <input type="text" id="patientLocation" required placeholder="City or village">
              <button type="button" class="location-detect-btn" id="detectLocationBtn" onclick="detectLocation()">
                üìç Detect My Location
              </button>
              <div class="location-info" id="locationInfo"></div>
              <input type="hidden" id="patientLat">
              <input type="hidden" id="patientLng">
            </div>
            <div class="form-group">
              <label>Symptoms (Select all applicable) *</label>
              <div class="symptom-grid" id="symptomGrid">
                <button type="button" class="symptom-btn" data-symptom="Diarrhea">Diarrhea</button>
                <button type="button" class="symptom-btn" data-symptom="Vomiting">Vomiting</button>
                <button type="button" class="symptom-btn" data-symptom="Fever">Fever</button>
                <button type="button" class="symptom-btn" data-symptom="Abdominal Pain">Abd. Pain</button>
                <button type="button" class="symptom-btn" data-symptom="Nausea">Nausea</button>
                <button type="button" class="symptom-btn" data-symptom="Dehydration">Dehydration</button>
              </div>
              <input type="hidden" id="selectedSymptoms" value="">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <div class="form-group">
                <label>Water Source *</label>
                <select id="waterSource" required>
                  <option value="">Select source</option>
                  <option value="Well">Well</option>
                  <option value="River">River</option>
                  <option value="Pond">Pond</option>
                  <option value="Tap Water">Tap Water</option>
                  <option value="Rainwater">Rainwater</option>
                </select>
              </div>
              <div class="form-group">
                <label>Severity Level</label>
                <select id="severity">
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">Critical</option>
                </select>
              </div>
            </div>
            <button type="submit" class="jarvis-btn" style="width: 100%; margin-top: 12px;">Submit Report</button>
          </form>
        </div>
      </div>

      <!-- Observer blocked message (hidden by default, shown for observers) -->
      <div id="reportBlockedMessage" style="display: none;">
        <div class="jarvis-panel">
          <div class="observer-blocked">
            <div class="blocked-icon">üîí</div>
            <h3>Access Restricted</h3>
            <p>Observers cannot report cases.<br>This feature is only available for <strong>Medical Officers</strong> and <strong>Administrators</strong>.</p>
            <button class="jarvis-btn" onclick="document.getElementById('logoutBtn').click()">
              Switch to Medical Officer Login
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Water Sources -->
    <div id="water" class="section-hidden">
      <h2 style="font-size: 24px; margin-bottom: 28px;">‚âã Water Source Monitoring</h2>
      <div class="jarvis-panel">
        <h2>Geographic Distribution</h2>
        <div id="map"></div>
      </div>
    </div>

    <!-- Analytics -->
    <div id="analytics" class="section-hidden">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 28px; flex-wrap: wrap; gap: 16px;">
        <div>
          <h2 style="font-size: 24px; margin-bottom: 8px;">‚ó¨ AI Analytics Engine</h2>
          <p style="font-size: 13px; color: #7f8c8d;">Real-time predictive analysis & insights</p>
        </div>
        <div class="ai-badge">AI-Powered Predictions</div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 28px;">
        <div class="protocol-card" style="background: linear-gradient(135deg, #ffebee 0%, #ffffff 100%);">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
            <div>
              <div style="font-family: 'Poppins', sans-serif; font-size: 11px; color: #7f8c8d; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Risk Level</div>
              <div style="font-family: 'Poppins', sans-serif; font-size: 32px; color: #e74c3c; font-weight: 700;">HIGH</div>
            </div>
            <div style="font-size: 48px; opacity: 0.6; animation: pulse 2s ease-in-out infinite;">‚ö†Ô∏è</div>
          </div>
          <div style="font-size: 13px; color: #546e7a; line-height: 1.6;">
            AI detected increasing case trend in Imphal region. Immediate action recommended.
          </div>
        </div>

        <div class="protocol-card" style="background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
            <div>
              <div style="font-family: 'Poppins', sans-serif; font-size: 11px; color: #7f8c8d; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Next Week Forecast</div>
              <div style="font-family: 'Poppins', sans-serif; font-size: 32px; color: #27ae60; font-weight: 700;">+12</div>
            </div>
            <div style="font-size: 48px; opacity: 0.6; animation: pulse 2s ease-in-out infinite;">üìà</div>
          </div>
          <div style="font-size: 13px; color: #546e7a; line-height: 1.6;">
            Predicted new cases based on current trajectory and seasonal patterns.
          </div>
        </div>

        <div class="protocol-card" style="background: linear-gradient(135deg, #fff3e0 0%, #ffffff 100%);">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
            <div>
              <div style="font-family: 'Poppins', sans-serif; font-size: 11px; color: #7f8c8d; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Top Risk Factor</div>
              <div style="font-family: 'Poppins', sans-serif; font-size: 20px; color: #f57c00; font-weight: 700;">WELLS</div>
            </div>
            <div style="font-size: 48px; opacity: 0.6; animation: pulse 2s ease-in-out infinite;">ü™£</div>
          </div>
          <div style="font-size: 13px; color: #546e7a; line-height: 1.6;">
            68% of cases linked to well water. Focus containment efforts here.
          </div>
        </div>
      </div>

      <div class="jarvis-panel">
        <h2>Case Trend Analysis</h2>
        <div class="chart-container">
          <canvas id="trendChart"></canvas>
        </div>
        <div style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
          <div style="font-family: 'Poppins', sans-serif; font-size: 11px; color: #7f8c8d; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
            ü§ñ AI Analysis
          </div>
          <div style="font-size: 14px; color: #2c3e50; line-height: 1.6;">
            The trend shows exponential growth pattern similar to waterborne outbreak scenarios. Peak expected in 5-7 days. Recommend immediate water quality testing in affected zones.
          </div>
        </div>
      </div>

      <div class="jarvis-panel" style="margin-top: 28px;">
        <h2 style="margin-bottom: 20px;">Geographic Heat Analysis</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
          <div class="protocol-card" style="cursor: pointer;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-family: 'Poppins', sans-serif; font-size: 14px; color: #2c3e50; font-weight: 600;">Imphal</div>
              <div style="width: 12px; height: 12px; background: #e74c3c; border-radius: 50%; box-shadow: 0 0 10px #e74c3c; animation: pulse 1s infinite;"></div>
            </div>
            <div style="font-family: 'Poppins', sans-serif; font-size: 28px; color: #e74c3c; font-weight: 700; margin-bottom: 8px;">12</div>
            <div style="font-size: 12px; color: #7f8c8d;">Critical Zone ‚Ä¢ +40% this week</div>
          </div>
          <div class="protocol-card" style="cursor: pointer;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-family: 'Poppins', sans-serif; font-size: 14px; color: #2c3e50; font-weight: 600;">Guwahati</div>
              <div style="width: 12px; height: 12px; background: #f57c00; border-radius: 50%; box-shadow: 0 0 10px #f57c00; animation: pulse 1s infinite;"></div>
            </div>
            <div style="font-family: 'Poppins', sans-serif; font-size: 28px; color: #f57c00; font-weight: 700; margin-bottom: 8px;">8</div>
            <div style="font-size: 12px; color: #7f8c8d;">Elevated ‚Ä¢ +15% this week</div>
          </div>
          <div class="protocol-card" style="cursor: pointer;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-family: 'Poppins', sans-serif; font-size: 14px; color: #2c3e50; font-weight: 600;">Shillong</div>
              <div style="width: 12px; height: 12px; background: #3498db; border-radius: 50%; box-shadow: 0 0 10px #3498db; animation: pulse 1s infinite;"></div>
            </div>
            <div style="font-family: 'Poppins', sans-serif; font-size: 28px; color: #3498db; font-weight: 700; margin-bottom: 8px;">3</div>
            <div style="font-size: 12px; color: #7f8c8d;">Moderate ‚Ä¢ Stable</div>
          </div>
          <div class="protocol-card" style="cursor: pointer;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-family: 'Poppins', sans-serif; font-size: 14px; color: #2c3e50; font-weight: 600;">Aizawl</div>
              <div style="width: 12px; height: 12px; background: #27ae60; border-radius: 50%; box-shadow: 0 0 10px #27ae60; animation: pulse 1s infinite;"></div>
            </div>
            <div style="font-family: 'Poppins', sans-serif; font-size: 28px; color: #27ae60; font-weight: 700; margin-bottom: 8px;">0</div>
            <div style="font-size: 12px; color: #7f8c8d;">Low Risk ‚Ä¢ No cases</div>
          </div>
        </div>

        <div style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e9 100%); border-radius: 12px; border: 1px solid #90caf9;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <div style="font-size: 32px; animation: float 3s ease-in-out infinite;">ü§ñ</div>
            <div style="font-family: 'Poppins', sans-serif; font-size: 14px; color: #2c3e50; font-weight: 700;">AI Recommendation</div>
          </div>
          <div style="font-size: 14px; color: #546e7a; line-height: 1.6;">
            Deploy emergency response teams to Imphal immediately. Implement water quality monitoring in Guwahati as preventive measure. Continue surveillance in Shillong. Aizawl protocols are effective - maintain current measures.
          </div>
        </div>
      </div>
    </div>

    <!-- Protocols -->
    <div id="protocols" class="section-hidden">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 28px; flex-wrap: wrap; gap: 16px;">
        <div>
          <h2 style="font-size: 24px; margin-bottom: 8px;">ü§ñ AI Health Protocols</h2>
          <p style="font-size: 13px; color: #7f8c8d;">Powered by AISH Intelligence Engine</p>
        </div>
        <div class="language-selector">
          <button class="language-btn active" onclick="changeLanguage('english', this)">English</button>
          <button class="language-btn" onclick="changeLanguage('tamil', this)">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
          <button class="language-btn" onclick="changeLanguage('malayalam', this)">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
          <button class="language-btn" onclick="changeLanguage('hindi', this)">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
          <button class="language-btn" onclick="changeLanguage('bengali', this)">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
        </div>
      </div>
      <div class="jarvis-panel">
        <div id="protocolsContent"></div>
      </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin" class="section-hidden">
      <div class="jarvis-panel">
        <h2>‚öôÔ∏è System Administration</h2>
        <p style="color: #7f8c8d; margin-bottom: 24px; font-size: 13px;">Administrator privileges active. You can manage cases from the Case Registry.</p>
        
        <div class="security-note">
          <strong>üîí Security Note:</strong>
          <p>All delete actions require explicit confirmation and are logged for audit purposes. Case deletions are permanent and cannot be undone.</p>
        </div>

        <div style="margin-top: 24px; padding: 20px; background: #e8f5e9; border-left: 4px solid #27ae60; border-radius: 8px;">
          <strong style="color: #27ae60; font-family: 'Poppins', sans-serif; font-size: 14px;">‚úì Active Admin Session</strong>
          <p style="color: #7f8c8d; margin-top: 8px; font-size: 13px;">You have full access to edit and delete cases. Navigate to the Dashboard to manage the Case Registry.</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Floating Chatbot Toggle Button -->
  <button class="chatbot-toggle" id="chatbotToggle" onclick="toggleChatbot()">
    ü§ñ
  </button>

  <!-- Floating Chatbot Popup -->
  <div class="chatbot-popup" id="chatbotPopup">
    <div class="chatbot-header">
      <h3>ü§ñ AISH Health Assistant</h3>
      <button class="chatbot-close" onclick="toggleChatbot()">‚úï</button>
    </div>
    
    <div class="chatbot-body">
      <div style="text-align: center; margin-bottom: 20px;">
        <div class="ai-badge" style="display: inline-block;">‚ö° AI ACTIVE</div>
        <p style="color: #7f8c8d; font-size: 13px; margin-top: 8px;">Multilingual AI-Powered Health Support</p>
      </div>

      <div style="margin-bottom: 16px;">
        <label style="font-weight: 600; color: #2c3e50; font-size: 12px; margin-bottom: 8px; display: block;">Select Language:</label>
        <div class="language-selector" style="display: flex; flex-wrap: wrap; gap: 6px;">
          <button class="language-btn active" id="chatLangEn" onclick="setChatLanguage('en')" style="padding: 6px 12px; font-size: 11px;">English</button>
          <button class="language-btn" id="chatLangHi" onclick="setChatLanguage('hi')" style="padding: 6px 12px; font-size: 11px;">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
          <button class="language-btn" id="chatLangTa" onclick="setChatLanguage('ta')" style="padding: 6px 12px; font-size: 11px;">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
          <button class="language-btn" id="chatLangTe" onclick="setChatLanguage('te')" style="padding: 6px 12px; font-size: 11px;">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
          <button class="language-btn" id="chatLangBn" onclick="setChatLanguage('bn')" style="padding: 6px 12px; font-size: 11px;">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
        </div>
      </div>

      <div id="chatMessages" style="background: #ffffff; border-radius: 12px; padding: 16px; height: 300px; overflow-y: auto; margin-bottom: 16px; border: 1px solid #e9ecef;">
        <div class="chat-message bot-message" style="margin-bottom: 12px; padding: 12px; background: #e3f2fd; border-radius: 12px; border-left: 4px solid #3498db;">
          <div style="font-weight: 600; color: #3498db; margin-bottom: 6px; font-size: 12px;">ü§ñ AISH Assistant</div>
          <div style="color: #2c3e50; font-size: 13px; line-height: 1.5;">Hello! I'm AISH, your health monitoring assistant. I can help you with:<br><br>
            ‚Ä¢ Understanding waterborne diseases<br>
            ‚Ä¢ Prevention guidelines<br>
            ‚Ä¢ Treatment protocols<br>
            ‚Ä¢ Symptom identification<br>
            ‚Ä¢ Emergency contacts<br><br>
            How can I assist you today?
          </div>
        </div>
      </div>

      <div style="margin-bottom: 16px; padding: 12px; background: #fff3cd; border-left: 3px solid #ffc107; border-radius: 8px;">
        <div style="font-weight: 600; color: #856404; font-size: 11px; margin-bottom: 8px;">üí° Quick Topics</div>
        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
          <button class="quick-topic-btn" onclick="askQuickQuestion('What is cholera?')" style="padding: 6px 12px; font-size: 11px;">Cholera</button>
          <button class="quick-topic-btn" onclick="askQuickQuestion('How to prevent waterborne diseases?')" style="padding: 6px 12px; font-size: 11px;">Prevention</button>
          <button class="quick-topic-btn" onclick="askQuickQuestion('What are symptoms of typhoid?')" style="padding: 6px 12px; font-size: 11px;">Typhoid</button>
          <button class="quick-topic-btn" onclick="askQuickQuestion('Emergency contacts')" style="padding: 6px 12px; font-size: 11px;">Emergency</button>
        </div>
      </div>
    </div>
    
    <div class="chatbot-footer">
      <div style="display: flex; gap: 8px;">
        <input type="text" id="chatInput" placeholder="Type your health question..." style="flex: 1; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 13px; font-family: 'Inter', sans-serif;" onkeypress="if(event.key==='Enter') sendChatMessage()">
        <button onclick="sendChatMessage()" style="padding: 10px 20px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 13px; transition: all 0.3s ease; font-family: 'Poppins', sans-serif;">Send</button>
      </div>
    </div>
  </div>

  <!-- Edit Case Modal -->
  <div id="editCaseModal" class="modal">
    <div class="modal-content">
      <div class="jarvis-panel">
        <h2 style="font-size: 24px; margin-bottom: 20px; text-align: center;">‚úèÔ∏è Edit Case</h2>
        <form id="editCaseForm">
          <div style="margin-bottom: 16px;">
            <label style="font-weight: 600; color: #2c3e50; font-size: 13px; margin-bottom: 8px; display: block;">Patient Name:</label>
            <input type="text" id="editPatientName" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; font-family: 'Inter', sans-serif;">
          </div>
          <div style="margin-bottom: 16px;">
            <label style="font-weight: 600; color: #2c3e50; font-size: 13px; margin-bottom: 8px; display: block;">Age:</label>
            <input type="number" id="editPatientAge" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; font-family: 'Inter', sans-serif;">
          </div>
          <div style="margin-bottom: 16px;">
            <label style="font-weight: 600; color: #2c3e50; font-size: 13px; margin-bottom: 8px; display: block;">Location:</label>
            <input type="text" id="editPatientLocation" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; font-family: 'Inter', sans-serif;">
          </div>
          <div style="margin-bottom: 16px;">
            <label style="font-weight: 600; color: #2c3e50; font-size: 13px; margin-bottom: 8px; display: block;">Symptoms:</label>
            <textarea id="editPatientSymptoms" required rows="3" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; font-family: 'Inter', sans-serif; resize: vertical;"></textarea>
          </div>
          <div style="margin-bottom: 16px;">
            <label style="font-weight: 600; color: #2c3e50; font-size: 13px; margin-bottom: 8px; display: block;">Water Source:</label>
            <select id="editWaterSource" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; font-family: 'Inter', sans-serif;">
              <option value="Well">Well</option>
              <option value="River">River</option>
              <option value="Pond">Pond</option>
              <option value="Municipal">Municipal Supply</option>
              <option value="Borewell">Borewell</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div style="margin-bottom: 16px;">
            <label style="font-weight: 600; color: #2c3e50; font-size: 13px; margin-bottom: 8px; display: block;">Severity:</label>
            <select id="editSeverity" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; font-family: 'Inter', sans-serif;">
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          <div style="margin-bottom: 20px;">
            <label style="font-weight: 600; color: #2c3e50; font-size: 13px; margin-bottom: 8px; display: block;">Status:</label>
            <select id="editStatus" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; font-family: 'Inter', sans-serif;">
              <option value="Active">Active</option>
              <option value="Recovered">Recovered</option>
              <option value="Under Treatment">Under Treatment</option>
            </select>
          </div>
          <div style="display: flex; gap: 12px;">
            <button type="submit" class="jarvis-btn" style="flex: 1;">üíæ Save Changes</button>
            <button type="button" onclick="closeEditModal()" class="jarvis-btn jarvis-btn-secondary" style="flex: 1;">‚ùå Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    let currentUser = null;
    let cases = [];

    // =============================================
    // DOCTORS LIST ‚Äî Admin can edit this!
    // Add or remove doctors here.
    // Each doctor has a name and their own password.
    // =============================================
    const DOCTORS = [
      { name: "Dr. Sharma",    password: "sharma123" },
      { name: "Dr. Priya",     password: "priya456" },
      { name: "Dr. Rahul",     password: "rahul789" },
      { name: "Dr. Meena",     password: "meena321" },
      { name: "Dr. Arjun",     password: "arjun654" },
    ];

    // =============================================
    // ADMIN CREDENTIALS ‚Äî Change these!
    // =============================================
    const ADMIN_USERNAME = "admin";
    const ADMIN_PASSWORD = "admin@AISH2026";
    let map = null;
    let chart = null;
    let isOnline = navigator.onLine;
    let currentLanguage = 'english';
    let userMarkers = [];
    let syncQueue = [];

    const translations = {
      english: {
        greeting: "Hello! I'm Dr. AISH, your AI health assistant.",
        doTitle: "What You SHOULD Do",
        dontTitle: "What You SHOULD NOT Do",
        dos: [
          "Always boil water for at least 1 minute before drinking",
          "Wash your hands with soap for 20 seconds before eating",
          "Store drinking water in clean, covered containers",
          "Report symptoms within 24 hours of onset",
          "Use oral rehydration solution (ORS) if experiencing diarrhea",
          "Seek immediate medical attention for severe symptoms"
        ],
        donts: [
          "Never drink untreated water from unknown sources",
          "Don't share utensils or cups with infected individuals",
          "Avoid consuming raw or undercooked food",
          "Don't ignore persistent gastrointestinal symptoms",
          "Never handle food when experiencing vomiting or diarrhea",
          "Don't swim in contaminated water bodies"
        ],
        tip: "Remember: Prevention is better than cure! Stay hydrated and maintain good hygiene."
      },
      tamil: {
        greeting: "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æ®‡Ææ‡Æ©‡Øç ‡Æü‡Ææ‡Æï‡Øç‡Æü‡Æ∞‡Øç AISH, ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç AI ‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞ ‡Æâ‡Æ§‡Æµ‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç.",
        doTitle: "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡Æø‡ÆØ‡Æµ‡Øà",
        dontTitle: "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æï‡Øç‡Æï‡ØÇ‡Æü‡Ææ‡Æ§‡Æµ‡Øà",
        dos: ["‡Æï‡ØÅ‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Æ§‡Æ±‡Øç‡Æï‡ØÅ ‡ÆÆ‡ØÅ‡Æ©‡Øç ‡Æï‡ØÅ‡Æ±‡Øà‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ 1 ‡Æ®‡Æø‡ÆÆ‡Æø‡Æü‡ÆÆ‡Øç ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øà ‡Æï‡Øä‡Æ§‡Æø‡Æï‡Øç‡Æï ‡Æµ‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç","‡Æâ‡Æ£‡Æµ‡ØÅ ‡Æâ‡Æ£‡Øç‡Æ™‡Æ§‡Æ±‡Øç‡Æï‡ØÅ ‡ÆÆ‡ØÅ‡Æ©‡Øç 20 ‡Æµ‡Æø‡Æ®‡Ææ‡Æü‡Æø‡Æï‡Æ≥‡Øç ‡Æö‡Øã‡Æ™‡Øç‡Æ™‡Ææ‡Æ≤‡Øç ‡Æï‡Øà‡Æï‡Æ≥‡Øà ‡Æï‡Æ¥‡ØÅ‡Æµ‡Æµ‡ØÅ‡ÆÆ‡Øç","‡Æï‡ØÅ‡Æü‡Æø‡Æ®‡ØÄ‡Æ∞‡Øà ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡ÆÆ‡Ææ‡Æ© ‡ÆÆ‡ØÇ‡Æü‡Æø‡ÆØ ‡Æ™‡Ææ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æö‡Øá‡ÆÆ‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç","‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øç ‡Æ§‡Øã‡Æ©‡Øç‡Æ±‡Æø‡ÆØ 24 ‡ÆÆ‡Æ£‡Æø ‡Æ®‡Øá‡Æ∞‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ‡Æ≥‡Øç ‡Æ™‡ØÅ‡Æï‡Ææ‡Æ∞‡Æ≥‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç","‡Æµ‡ÆØ‡Æø‡Æ±‡Øç‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Øã‡Æï‡Øç‡Æï‡ØÅ ‡Æè‡Æ±‡Øç‡Æ™‡Æü‡Øç‡Æü‡Ææ‡Æ≤‡Øç ORS ‡Æï‡Æ∞‡Øà‡Æö‡Æ≤‡Øà ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç","‡Æï‡Æü‡ØÅ‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ© ‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æâ‡Æü‡Æ©‡Æü‡Æø‡ÆØ‡Ææ‡Æï ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ ‡Æâ‡Æ§‡Æµ‡Æø ‡Æ™‡ØÜ‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç"],
        donts: ["‡Æ§‡ØÜ‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ§ ‡ÆÜ‡Æ§‡Ææ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Æø‡Æ≤‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æö‡ØÅ‡Æ§‡Øç‡Æ§‡Æø‡Æï‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Ææ‡Æ§ ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øà ‡Æï‡ØÅ‡Æü‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç","‡Æ®‡Øã‡ÆØ‡ØÅ‡Æ±‡Øç‡Æ± ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡ØÅ‡Æü‡Æ©‡Øç ‡Æ™‡Ææ‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æ™‡Æï‡Æø‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÅ ‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡Ææ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç","‡Æ™‡Æö‡Øç‡Æö‡Øà ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡ÆÆ‡ØÅ‡Æ¥‡ØÅ‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æï ‡Æö‡ÆÆ‡Øà‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Ææ‡Æ§ ‡Æâ‡Æ£‡Æµ‡Øà ‡Æâ‡Æ£‡Øç‡Æ£‡Ææ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç","‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø‡ÆØ‡Ææ‡Æ© ‡Æµ‡ÆØ‡Æø‡Æ±‡ØÅ ‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øà ‡Æ™‡ØÅ‡Æ±‡Æï‡Øç‡Æï‡Æ£‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç","‡Æµ‡Ææ‡Æ®‡Øç‡Æ§‡Æø ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æµ‡ÆØ‡Æø‡Æ±‡Øç‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Øã‡Æï‡Øç‡Æï‡ØÅ ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡Æâ‡Æ£‡Æµ‡ØÅ ‡Æ§‡ÆØ‡Ææ‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç","‡ÆÆ‡Ææ‡Æö‡ØÅ‡Æ™‡Æü‡Øç‡Æü ‡Æ®‡ØÄ‡Æ∞‡Øç‡Æ®‡Æø‡Æ≤‡Øà‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æ®‡ØÄ‡Æ®‡Øç‡Æ§‡Ææ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç"],
        tip: "‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡Æø‡Æ≤‡Øç ‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç: ‡Æ§‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ ‡Æö‡Æø‡Æï‡Æø‡Æö‡Øç‡Æö‡Øà‡ÆØ‡Øà ‡Æµ‡Æø‡Æü ‡Æö‡Æø‡Æ±‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ! ‡Æ®‡ØÄ‡Æ∞‡Øá‡Æ±‡Øç‡Æ±‡ÆÆ‡Ææ‡Æï ‡Æá‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Æ≤‡Øç‡Æ≤ ‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞‡Æ§‡Øç‡Æ§‡Øà ‡Æ™‡Øá‡Æ£‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç."
      },
      malayalam: {
        greeting: "‡¥π‡¥≤‡µã! ‡¥û‡¥æ‡µª ‡¥°‡µã. AISH, ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ AI ‡¥Ü‡¥∞‡µã‡¥ó‡µç‡¥Ø ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø.",
        doTitle: "‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µá‡¥£‡µç‡¥ü‡¥µ",
        dontTitle: "‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥∞‡µÅ‡¥§‡¥æ‡¥§‡µç‡¥§‡¥µ",
        dos: ["‡¥ï‡µÅ‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡¥ø‡¥®‡µÅ ‡¥Æ‡µÅ‡¥Æ‡µç‡¥™‡µç ‡¥ï‡µÅ‡¥±‡¥û‡µç‡¥û‡¥§‡µç 1 ‡¥Æ‡¥ø‡¥®‡¥ø‡¥±‡µç‡¥±‡µç ‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥Ç ‡¥§‡¥ø‡¥≥‡¥™‡µç‡¥™‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï","‡¥≠‡¥ï‡µç‡¥∑‡¥£‡¥Ç ‡¥ï‡¥¥‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡¥ø‡¥®‡µÅ ‡¥Æ‡µÅ‡¥Æ‡µç‡¥™‡µç 20 ‡¥∏‡µÜ‡¥ï‡µç‡¥ï‡µª‡¥°‡µç ‡¥∏‡µã‡¥™‡µç‡¥™‡µç ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ö‡µç‡¥ö‡µç ‡¥ï‡µà ‡¥ï‡¥¥‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï","‡¥ï‡µÅ‡¥ü‡¥ø‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥Ç ‡¥µ‡µÉ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡µÅ‡¥≥‡µç‡¥≥ ‡¥Æ‡µÇ‡¥ü‡¥ø‡¥Ø ‡¥™‡¥æ‡¥§‡µç‡¥∞‡¥ô‡µç‡¥ô‡¥≥‡¥ø‡µΩ ‡¥∏‡µÇ‡¥ï‡µç‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï","‡¥≤‡¥ï‡µç‡¥∑‡¥£‡¥ô‡µç‡¥ô‡µæ ‡¥™‡µç‡¥∞‡¥§‡µç‡¥Ø‡¥ï‡µç‡¥∑‡¥™‡µç‡¥™‡µÜ‡¥ü‡µç‡¥ü‡µç 24 ‡¥Æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÇ‡¥±‡¥ø‡¥®‡µÅ‡¥≥‡µç‡¥≥‡¥ø‡µΩ ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï","‡¥µ‡¥Ø‡¥±‡¥ø‡¥≥‡¥ï‡µç‡¥ï‡¥Ç ‡¥â‡¥£‡µç‡¥ü‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ORS ‡¥≤‡¥æ‡¥Ø‡¥®‡¥ø ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï","‡¥ó‡µÅ‡¥∞‡µÅ‡¥§‡¥∞‡¥Æ‡¥æ‡¥Ø ‡¥≤‡¥ï‡µç‡¥∑‡¥£‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥â‡¥ü‡µª ‡¥µ‡µà‡¥¶‡µç‡¥Ø‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç ‡¥§‡µá‡¥ü‡µÅ‡¥ï"],
        donts: ["‡¥Ö‡¥ú‡µç‡¥û‡¥æ‡¥§ ‡¥∏‡µç‡¥∞‡µã‡¥§‡¥∏‡µç‡¥∏‡µÅ‡¥ï‡¥≥‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥∂‡µÅ‡¥¶‡µç‡¥ß‡µÄ‡¥ï‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥§‡µç‡¥§ ‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥Ç ‡¥ï‡µÅ‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡¥∞‡µÅ‡¥§‡µç","‡¥∞‡µã‡¥ó‡¥¨‡¥æ‡¥ß‡¥ø‡¥§‡¥∞‡µÅ‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥™‡¥æ‡¥§‡µç‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥™‡¥ô‡µç‡¥ï‡¥ø‡¥ü‡¥∞‡µÅ‡¥§‡µç","‡¥Ö‡¥∏‡¥Ç‡¥∏‡µç‡¥ï‡µÉ‡¥§‡¥Æ‡µã ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥™‡¥æ‡¥ï‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥§‡µç‡¥§ ‡¥≠‡¥ï‡µç‡¥∑‡¥£‡¥Ç ‡¥ï‡¥¥‡¥ø‡¥ï‡µç‡¥ï‡¥∞‡µÅ‡¥§‡µç","‡¥§‡µÅ‡¥ü‡µº‡¥ö‡µç‡¥ö‡¥Ø‡¥æ‡¥Ø ‡¥¶‡¥π‡¥®‡¥∏‡¥Ç‡¥¨‡¥®‡µç‡¥ß‡¥Æ‡¥æ‡¥Ø ‡¥≤‡¥ï‡µç‡¥∑‡¥£‡¥ô‡µç‡¥ô‡µæ ‡¥Ö‡¥µ‡¥ó‡¥£‡¥ø‡¥ï‡µç‡¥ï‡¥∞‡µÅ‡¥§‡µç","‡¥õ‡µº‡¥¶‡µç‡¥¶‡¥ø ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥µ‡¥Ø‡¥±‡¥ø‡¥≥‡¥ï‡µç‡¥ï‡¥Ç ‡¥Ö‡¥®‡µÅ‡¥≠‡¥µ‡¥™‡µç‡¥™‡µÜ‡¥ü‡µÅ‡¥Æ‡µç‡¥™‡µã‡µæ ‡¥≠‡¥ï‡µç‡¥∑‡¥£‡¥Ç ‡¥ï‡µà‡¥ï‡¥æ‡¥∞‡µç‡¥Ø‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥∞‡µÅ‡¥§‡µç","‡¥Æ‡¥≤‡¥ø‡¥®‡¥Æ‡¥æ‡¥Ø ‡¥ú‡¥≤‡¥æ‡¥∂‡¥Ø‡¥ô‡µç‡¥ô‡¥≥‡¥ø‡µΩ ‡¥®‡µÄ‡¥®‡µç‡¥§‡¥∞‡µÅ‡¥§‡µç"],
        tip: "‡¥ì‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥ï: ‡¥™‡µç‡¥∞‡¥§‡¥ø‡¥∞‡µã‡¥ß‡¥Ç ‡¥ö‡¥ø‡¥ï‡¥ø‡¥§‡µç‡¥∏‡¥Ø‡µá‡¥ï‡µç‡¥ï‡¥æ‡µæ ‡¥®‡¥≤‡µç‡¥≤‡¥§‡µç! ‡¥ú‡¥≤‡¥æ‡¥Ç‡¥∂‡¥Ç ‡¥®‡¥ø‡¥≤‡¥®‡¥ø‡µº‡¥§‡µç‡¥§‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥®‡¥≤‡µç‡¥≤ ‡¥∂‡µÅ‡¥ö‡¥ø‡¥§‡µç‡¥µ‡¥Ç ‡¥™‡¥æ‡¥≤‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µÅ‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï."
      },
      hindi: {
        greeting: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§°‡•â. AISH ‡§π‡•Ç‡§Ç, ‡§Ü‡§™‡§ï‡§æ AI ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§π‡§æ‡§Ø‡§ï‡•§",
        doTitle: "‡§Ü‡§™‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è",
        dontTitle: "‡§Ü‡§™‡§ï‡•ã ‡§ï‡•ç‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è",
        dos: ["‡§™‡•Ä‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 1 ‡§Æ‡§ø‡§®‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§æ‡§®‡•Ä ‡§â‡§¨‡§æ‡§≤‡•á‡§Ç","‡§ñ‡§æ‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á 20 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§æ‡§¨‡•Å‡§® ‡§∏‡•á ‡§π‡§æ‡§• ‡§ß‡•ã‡§è‡§Ç","‡§™‡•Ä‡§®‡•á ‡§ï‡•á ‡§™‡§æ‡§®‡•Ä ‡§ï‡•ã ‡§∏‡§æ‡§´, ‡§¢‡§ï‡•á ‡§π‡•Å‡§è ‡§¨‡§∞‡•ç‡§§‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡•á‡§Ç","‡§≤‡§ï‡•ç‡§∑‡§£ ‡§¶‡§ø‡§ñ‡§®‡•á ‡§ï‡•á 24 ‡§ò‡§Ç‡§ü‡•á ‡§ï‡•á ‡§≠‡•Ä‡§§‡§∞ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç","‡§¶‡§∏‡•ç‡§§ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ORS ‡§ò‡•ã‡§≤ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç","‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§≤‡•á‡§Ç"],
        donts: ["‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§∏‡•ç‡§∞‡•ã‡§§‡•ã‡§Ç ‡§∏‡•á ‡§¨‡§ø‡§®‡§æ ‡§â‡§™‡§ö‡§æ‡§∞‡§ø‡§§ ‡§™‡§æ‡§®‡•Ä ‡§® ‡§™‡§ø‡§è‡§Ç","‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§ø‡§§ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§¨‡§∞‡•ç‡§§‡§® ‡§∏‡§æ‡§ù‡§æ ‡§® ‡§ï‡§∞‡•á‡§Ç","‡§ï‡§ö‡•ç‡§ö‡§æ ‡§Ø‡§æ ‡§Ö‡§ß‡§™‡§ï‡§æ ‡§≠‡•ã‡§ú‡§® ‡§® ‡§ñ‡§æ‡§è‡§Ç","‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§ó‡•à‡§∏‡•ç‡§ü‡•ç‡§∞‡•ã‡§á‡§Ç‡§ü‡•á‡§∏‡•ç‡§ü‡§æ‡§á‡§®‡§≤ ‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§ï‡•ã ‡§®‡§ú‡§∞‡§Ö‡§Ç‡§¶‡§æ‡§ú ‡§® ‡§ï‡§∞‡•á‡§Ç","‡§â‡§≤‡•ç‡§ü‡•Ä ‡§Ø‡§æ ‡§¶‡§∏‡•ç‡§§ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§≠‡•ã‡§ú‡§® ‡§® ‡§∏‡§Ç‡§≠‡§æ‡§≤‡•á‡§Ç","‡§¶‡•Ç‡§∑‡§ø‡§§ ‡§ú‡§≤ ‡§®‡§ø‡§ï‡§æ‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§§‡•à‡§∞‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç"],
        tip: "‡§Ø‡§æ‡§¶ ‡§∞‡§ñ‡•á‡§Ç: ‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ ‡§á‡§≤‡§æ‡§ú ‡§∏‡•á ‡§¨‡•á‡§π‡§§‡§∞ ‡§π‡•à! ‡§π‡§æ‡§á‡§°‡•ç‡§∞‡•á‡§ü‡•á‡§° ‡§∞‡§π‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ‡§§‡§æ ‡§¨‡§®‡§æ‡§è ‡§∞‡§ñ‡•á‡§Ç‡•§"
      },
      bengali: {
        greeting: "‡¶π‡ßç‡¶Ø‡¶æ‡¶≤‡ßã! ‡¶Ü‡¶Æ‡¶ø ‡¶°‡¶æ‡¶É AISH, ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ AI ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶ï‡•§",
        doTitle: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ø‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶â‡¶ö‡¶ø‡¶§",
        dontTitle: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ø‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶â‡¶ö‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º",
        dos: ["‡¶™‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ßß ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶æ‡¶®‡¶ø ‡¶´‡ßã‡¶ü‡¶æ‡¶®","‡¶ñ‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡ß®‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶∏‡¶æ‡¶¨‡¶æ‡¶® ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶π‡¶æ‡¶§ ‡¶ß‡ßÅ‡¶Ø‡¶º‡ßá ‡¶®‡¶ø‡¶®","‡¶™‡¶æ‡¶®‡ßÄ‡¶Ø‡¶º ‡¶ú‡¶≤ ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞, ‡¶¢‡¶æ‡¶ï‡¶®‡¶æ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶™‡¶æ‡¶§‡ßç‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®","‡¶≤‡¶ï‡ßç‡¶∑‡¶£ ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®","‡¶°‡¶æ‡¶Ø‡¶º‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶π‡¶≤‡ßá ORS ‡¶¶‡ßç‡¶∞‡¶¨‡¶£ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®","‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡¶∞ ‡¶≤‡¶ï‡ßç‡¶∑‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶¨‡¶ø‡¶≤‡¶Æ‡ßç‡¶¨‡ßá ‡¶ö‡¶ø‡¶ï‡¶ø‡ßé‡¶∏‡¶æ ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶§‡¶æ ‡¶®‡¶ø‡¶®"],
        donts: ["‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶â‡ßé‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ ‡¶™‡¶æ‡¶®‡¶ø ‡¶™‡¶æ‡¶® ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ","‡¶∏‡¶Ç‡¶ï‡ßç‡¶∞‡¶Æ‡¶ø‡¶§ ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶™‡¶æ‡¶§‡ßç‡¶∞ ‡¶≠‡¶æ‡¶ó ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ","‡¶ï‡¶æ‡¶Å‡¶ö‡¶æ ‡¶¨‡¶æ ‡¶Ü‡¶ß‡¶æ ‡¶∞‡¶æ‡¶®‡ßç‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶ñ‡¶æ‡¶¨‡ßá‡¶® ‡¶®‡¶æ","‡¶ï‡ßç‡¶∞‡¶Æ‡¶æ‡¶ó‡¶§ ‡¶™‡¶æ‡¶ö‡¶®‡¶§‡¶®‡ßç‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶≤‡¶ï‡ßç‡¶∑‡¶£ ‡¶â‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ","‡¶¨‡¶Æ‡¶ø ‡¶¨‡¶æ ‡¶°‡¶æ‡¶Ø‡¶º‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶π‡¶≤‡ßá ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶®‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ","‡¶¶‡ßÇ‡¶∑‡¶ø‡¶§ ‡¶ú‡¶≤‡¶æ‡¶∂‡¶Ø‡¶º‡ßá ‡¶∏‡¶æ‡¶Å‡¶§‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ü‡¶¨‡ßá‡¶® ‡¶®‡¶æ"],
        tip: "‡¶Æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßá‡¶®: ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∞‡ßã‡¶ß ‡¶≠‡¶æ‡¶≤! ‡¶π‡¶æ‡¶á‡¶°‡ßç‡¶∞‡ßá‡¶ü‡ßá‡¶° ‡¶•‡¶æ‡¶ï‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶≠‡¶æ‡¶≤ ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø‡¶¨‡¶ø‡¶ß‡¶ø ‡¶¨‡¶ú‡¶æ‡¶Ø‡¶º ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®‡•§"
      }
    };

    function changeLanguage(lang, btn) {
      currentLanguage = lang;
      saveToStorage('preferredLanguage', lang);
      // Update active button in protocols tab only
      const protocolLangBtns = document.querySelectorAll('#protocols .language-btn');
      protocolLangBtns.forEach(b => b.classList.remove('active'));
      if (btn) btn.classList.add('active');
      updateProtocolsDisplay();
      showNotification('Language changed to ' + lang, 'success');
    }

    function updateProtocolsDisplay() {
      const content = translations[currentLanguage];
      const protocolsContainer = document.getElementById('protocolsContent');
      if (protocolsContainer) {
        protocolsContainer.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; gap: 32px; margin-bottom: 40px; padding: 32px; background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e9 100%); border-radius: 16px; position: relative; overflow: hidden;">
            <div class="ai-doctor-avatar">ü§ñ</div>
            <div style="flex: 1; max-width: 600px;">
              <div class="ai-badge" style="margin-bottom: 16px;">AI-Powered Health Assistant</div>
              <div style="font-family: 'Poppins', sans-serif; font-size: 20px; color: #2c3e50; font-weight: 700; margin-bottom: 12px;">${content.greeting}</div>
              <div style="font-size: 14px; color: #546e7a; display: flex; align-items: center;"><span>Analyzing health protocols</span><span class="ai-thinking"><span></span><span></span><span></span></span></div>
            </div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px;">
            <div class="protocol-card do-card">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #27ae60 0%, #229954 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3); color: white;">‚úì</div>
                <div><div style="color: #27ae60; font-size: 16px; font-family: 'Poppins', sans-serif; font-weight: 700;">${content.doTitle}</div><div style="font-size: 11px; color: #95a5a6; text-transform: uppercase; letter-spacing: 1px;">Recommended Actions</div></div>
              </div>
              <ul style="margin-top: 16px; list-style: none; padding: 0;">${content.dos.map((item, i) => `<li style="margin-bottom: 14px; padding-left: 24px; position: relative; animation: slideIn 0.5s ease-out ${i * 0.1}s both; color: #546e7a;"><span style="position: absolute; left: 0; color: #27ae60;">‚ñ∏</span>${item}</li>`).join('')}</ul>
            </div>
            <div class="protocol-card dont-card">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3); color: white;">‚úó</div>
                <div><div style="color: #e74c3c; font-size: 16px; font-family: 'Poppins', sans-serif; font-weight: 700;">${content.dontTitle}</div><div style="font-size: 11px; color: #95a5a6; text-transform: uppercase; letter-spacing: 1px;">Actions to Avoid</div></div>
              </div>
              <ul style="margin-top: 16px; list-style: none; padding: 0;">${content.donts.map((item, i) => `<li style="margin-bottom: 14px; padding-left: 24px; position: relative; animation: slideIn 0.5s ease-out ${i * 0.1}s both; color: #546e7a;"><span style="position: absolute; left: 0; color: #e74c3c;">‚ñ∏</span>${item}</li>`).join('')}</ul>
            </div>
          </div>
          <div style="padding: 28px; background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e9 100%); border-radius: 12px; border: 2px solid #90caf9; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 16px; animation: pulse 2s ease-in-out infinite;">üí°</div>
            <div style="font-family: 'Poppins', sans-serif; font-size: 12px; color: #7f8c8d; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px;">AI Tip of the Day</div>
            <div style="font-size: 16px; color: #2c3e50; font-weight: 600; line-height: 1.6;">${content.tip}</div>
          </div>`;
      }
    }

    const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
      ? 'http://localhost:3000/api'
      : 'https://aish-health.onrender.com/api';
    let serverAvailable = false;
    
    async function checkServerConnection() {
      try {
        const response = await fetch(`${API_URL}/health`, { method: 'GET', headers: { 'Content-Type': 'application/json' } });
        if (response.ok) { serverAvailable = true; return true; }
      } catch (error) { serverAvailable = false; }
      return false;
    }
    
    async function saveToStorage(key, data) {
      try { localStorage.setItem(key, JSON.stringify(data)); } catch (e) { console.error('Storage error:', e); }
    }

    function loadFromStorage(key) {
      try { const data = localStorage.getItem(key); return data ? JSON.parse(data) : null; } catch (e) { return null; }
    }

    async function fetchAllCases() {
      if (!serverAvailable && !await checkServerConnection()) {
        cases = loadFromStorage('healthCases') || [];
        updateDashboard(); renderCaseTable(); updateMapMarkers();
        return cases;
      }
      try {
        const response = await fetch(`${API_URL}/cases`);
        if (!response.ok) throw new Error('Failed to fetch cases');
        const data = await response.json();
        cases = data.map(c => ({ ...c, _id: c._id, synced: true }));
        serverAvailable = true;
        updateDashboard(); renderCaseTable(); updateMapMarkers();
        return cases;
      } catch (error) {
        serverAvailable = false;
        cases = loadFromStorage('healthCases') || [];
        updateDashboard(); renderCaseTable(); updateMapMarkers();
        return cases;
      }
    }

    async function createCase(caseData) {
      try {
        const response = await fetch(`${API_URL}/cases`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(caseData) });
        if (!response.ok) throw new Error('Failed to create case');
        return await response.json();
      } catch (error) {
        syncQueue.push(caseData);
        saveToStorage('syncQueue', syncQueue);
        throw error;
      }
    }

    async function updateCase(caseId, caseData) {
      const response = await fetch(`${API_URL}/cases/${caseId}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(caseData) });
      if (!response.ok) throw new Error('Failed to update case');
      return await response.json();
    }

    async function deleteCase(caseId) {
      const response = await fetch(`${API_URL}/cases/${caseId}`, { method: 'DELETE' });
      if (!response.ok) throw new Error('Failed to delete case');
      return await response.json();
    }

    async function syncQueuedCasesToMongoDB() {
      if (syncQueue.length === 0) return;
      try {
        const response = await fetch(`${API_URL}/cases/sync`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ cases: syncQueue }) });
        if (!response.ok) throw new Error('Failed to sync');
        const result = await response.json();
        syncQueue = [];
        saveToStorage('syncQueue', []);
        showNotification(`‚úì ${result.cases.length} cases synced to database`, 'success');
        await fetchAllCases();
      } catch (error) {
        showNotification('‚ö† Sync failed, will retry later', 'warning');
      }
    }

    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
    }

    function updateDashboard() {
      const total = cases.length + 24;
      const active = cases.filter(c => c.status === 'Active').length + 8;
      const critical = cases.filter(c => c.severity === 'high').length + 6;
      const recovered = cases.filter(c => c.status === 'Recovered').length + 14;
      document.getElementById('totalCases').textContent = total;
      document.getElementById('activeCases').textContent = active;
      document.getElementById('criticalCases').textContent = critical;
      document.getElementById('recoveredCases').textContent = recovered;
    }

    function renderCaseTable() {
      const tbody = document.getElementById('caseTableBody');
      const existingRows = tbody.querySelectorAll('tr:not(.default-case)');
      existingRows.forEach(row => row.remove());
      const severityMap = { high: 'severity-high', medium: 'severity-medium', low: 'severity-low' };
      const severityText = { high: 'Critical', medium: 'Medium', low: 'Low' };
      const isAdmin = currentUser && currentUser.role === 'admin';
      cases.forEach((caseData, index) => {
        const row = tbody.insertRow(0);
        row.innerHTML = `
          <td><strong>${caseData.name}</strong><br><span style="color: #95a5a6;">Age: ${caseData.age}</span></td>
          <td>${caseData.location}</td>
          <td>${caseData.symptoms.split(', ').map(s => `<span class="symptom-badge">${s}</span>`).join('')}</td>
          <td><span class="severity-badge ${severityMap[caseData.severity]}">${severityText[caseData.severity]}</span></td>
          <td><span style="color: ${caseData.status === 'Active' ? '#e74c3c' : '#27ae60'}; font-weight: 700;">${caseData.status}</span></td>
          <td>${caseData.date}</td>
          <td style="color: #7f8c8d; font-size: 12px;">${caseData.reportedBy || 'Unknown'}</td>
          <td>${isAdmin ? `<button class="jarvis-btn" onclick="editCaseModal(${index})" style="margin-right: 8px; padding: 8px 16px; font-size: 10px;">‚úèÔ∏è Edit</button><button class="jarvis-btn jarvis-btn-danger" onclick="deleteCaseFunc(${index})">üóëÔ∏è Delete</button>` : ''}</td>`;
      });
    }

    async function deleteCaseFunc(index) {
      if (!currentUser || currentUser.role !== 'admin') { showNotification('‚ö†Ô∏è Admin access required', 'error'); return; }
      const caseToDelete = cases[index];
      if (confirm(`‚ö†Ô∏è DELETE CASE?\n\nPatient: ${caseToDelete.name}\nAge: ${caseToDelete.age}\nLocation: ${caseToDelete.location}\n\nThis cannot be undone!`)) {
        if (caseToDelete._id && isOnline) {
          try {
            await deleteCase(caseToDelete._id);
            cases.splice(index, 1);
            showNotification(`‚úì Case deleted: ${caseToDelete.name}`, 'success');
          } catch (error) { showNotification('‚ùå Failed to delete from database', 'error'); return; }
        } else {
          cases.splice(index, 1);
          saveToStorage('healthCases', cases);
          showNotification(`‚úì Case deleted locally: ${caseToDelete.name}`, 'success');
        }
        renderCaseTable(); updateDashboard(); updateMapMarkers();
      }
    }
    window.deleteCaseFunc = deleteCaseFunc;

    let currentEditIndex = null;

    function editCaseModal(index) {
      if (!currentUser || currentUser.role !== 'admin') { showNotification('‚ö†Ô∏è Admin access required', 'error'); return; }
      currentEditIndex = index;
      const caseData = cases[index];
      document.getElementById('editPatientName').value = caseData.name;
      document.getElementById('editPatientAge').value = caseData.age;
      document.getElementById('editPatientLocation').value = caseData.location;
      document.getElementById('editPatientSymptoms').value = caseData.symptoms;
      document.getElementById('editWaterSource').value = caseData.waterSource;
      document.getElementById('editSeverity').value = caseData.severity;
      document.getElementById('editStatus').value = caseData.status;
      document.getElementById('editCaseModal').classList.add('active');
    }
    window.editCaseModal = editCaseModal;

    function closeEditModal() {
      document.getElementById('editCaseModal').classList.remove('active');
      currentEditIndex = null;
    }
    window.closeEditModal = closeEditModal;

    document.getElementById('editCaseForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (currentEditIndex === null) return;
      const updatedCase = { ...cases[currentEditIndex], name: document.getElementById('editPatientName').value, age: parseInt(document.getElementById('editPatientAge').value), location: document.getElementById('editPatientLocation').value, symptoms: document.getElementById('editPatientSymptoms').value, waterSource: document.getElementById('editWaterSource').value, severity: document.getElementById('editSeverity').value, status: document.getElementById('editStatus').value };
      if (updatedCase._id && serverAvailable && isOnline) {
        try { await updateCase(updatedCase._id, updatedCase); cases[currentEditIndex] = updatedCase; showNotification('‚úì Case updated in database', 'success'); }
        catch (error) { cases[currentEditIndex] = updatedCase; saveToStorage('healthCases', cases); showNotification('‚ö† Update saved locally', 'warning'); }
      } else { cases[currentEditIndex] = updatedCase; saveToStorage('healthCases', cases); showNotification('‚ö† Update saved locally', 'warning'); }
      updateDashboard(); renderCaseTable(); updateMapMarkers(); closeEditModal();
    });

    document.getElementById('editCaseModal').addEventListener('click', (e) => { if (e.target.id === 'editCaseModal') closeEditModal(); });

    // =============================================
    // FIX 1: Show/hide report form based on role
    // =============================================
    function updateReportTabVisibility() {
      const isObserver = !currentUser || currentUser.role === 'viewer';
      document.getElementById('reportFormContainer').style.display = isObserver ? 'none' : 'block';
      document.getElementById('reportBlockedMessage').style.display = isObserver ? 'block' : 'none';
    }

    function loginUser() {
      document.getElementById('loginModal').classList.remove('active');
      document.getElementById('userBadge').style.display = 'flex';
      document.getElementById('userIcon').textContent = currentUser.icon;
      document.getElementById('userName').textContent = currentUser.name;
      if (currentUser.role === 'admin') {
        document.getElementById('adminBtn').style.display = 'block';
        document.getElementById('actionsHeader').style.display = 'table-cell';
      }
      saveToStorage('currentUser', currentUser);
      updateReportTabVisibility(); // <-- ADDED
      renderCaseTable();
      showNotification(`‚úì Welcome ${currentUser.name}`, 'success');
    }

    function initMap() {
      if (map) return;
      const mapContainer = document.getElementById('map');
      if (!isOnline) {
        mapContainer.innerHTML = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f8f9fa; border-radius: 8px;"><div style="text-align: center; color: #95a5a6;"><div style="font-size: 48px; margin-bottom: 16px;">‚ö†</div><div style="font-family: 'Poppins', sans-serif; font-size: 14px; font-weight: 600;">Map Unavailable</div><div style="font-size: 12px; margin-top: 8px;">Internet connection required</div></div></div>`;
        return;
      }
      try {
        map = L.map('map').setView([25.5788, 91.8933], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);
        const locations = [
          { lat: 24.8170, lng: 93.9368, name: 'Imphal', cases: 12, color: '#e74c3c' },
          { lat: 26.1445, lng: 91.7362, name: 'Guwahati', cases: 8, color: '#e74c3c' },
          { lat: 25.5788, lng: 91.8933, name: 'Shillong', cases: 3, color: '#3498db' }
        ];
        locations.forEach(loc => {
          L.circle([loc.lat, loc.lng], { color: loc.color, fillColor: loc.color, fillOpacity: 0.3, radius: loc.cases * 5000 + 10000 }).addTo(map).bindPopup(`<strong>${loc.name}</strong><br>Cases: ${loc.cases}`);
        });
        updateMapMarkers();
      } catch (e) { console.error('Map error:', e); }
    }

    function updateMapMarkers() {
      if (!map) return;
      userMarkers.forEach(marker => map.removeLayer(marker));
      userMarkers = [];
      cases.forEach(c => {
        if (c.lat && c.lng) {
          const marker = L.marker([c.lat, c.lng], { icon: L.divIcon({ className: 'custom-marker', html: `<div style="background: #e74c3c; border-radius: 50%; width: 20px; height: 20px; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>`, iconSize: [20, 20] }) }).addTo(map);
          marker.bindPopup(`<strong>${c.name}</strong><br>Location: ${c.location}<br>Symptoms: ${c.symptoms}<br>Severity: ${c.severity}<br>Date: ${c.date}`);
          userMarkers.push(marker);
        }
      });
    }

    function initChart() {
      if (chart) return;
      const ctx = document.getElementById('trendChart');
      if (!ctx) return;
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Oct 13', 'Oct 14', 'Oct 15', 'Oct 16', 'Oct 17', 'Oct 18'],
          datasets: [{ label: 'Actual Cases', data: [2, 3, 4, 3, 5, 7], borderColor: '#3498db', backgroundColor: 'rgba(52, 152, 219, 0.1)', tension: 0.4, fill: true, borderWidth: 3, pointRadius: 6, pointHoverRadius: 8, pointBackgroundColor: '#3498db', pointBorderColor: '#ffffff', pointBorderWidth: 2 }, { label: 'AI Prediction', data: [null, null, null, null, 5, 7, 9, 11], borderColor: '#f57c00', backgroundColor: 'rgba(245, 124, 0, 0.1)', tension: 0.4, fill: true, borderWidth: 3, borderDash: [10, 5], pointRadius: 6, pointHoverRadius: 8, pointBackgroundColor: '#f57c00', pointBorderColor: '#ffffff', pointBorderWidth: 2 }]
        },
        options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false }, plugins: { legend: { labels: { font: { family: 'Inter', size: 13, weight: '600' } } } }, scales: { y: { beginAtZero: true } } }
      });
    }

    function switchTab(tabName) {
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('main > div').forEach(section => {
        if (section.id === tabName) {
          section.classList.remove('section-hidden');
          section.classList.add('section-visible');
          document.querySelector(`[data-tab="${tabName}"]`)?.classList.add('active');
        } else {
          section.classList.remove('section-visible');
          section.classList.add('section-hidden');
        }
      });
      if (tabName === 'water') setTimeout(() => initMap(), 100);
      if (tabName === 'analytics') setTimeout(() => initChart(), 100);
      if (tabName === 'protocols') updateProtocolsDisplay();
      // FIX 2: Update report tab content whenever it's opened
      if (tabName === 'report') updateReportTabVisibility();
    }

    // Character selection
    document.querySelectorAll('.character-card').forEach(card => {
      card.addEventListener('click', () => {
        const role = card.getAttribute('data-role');
        if (role === 'admin') {
          document.getElementById('characterSelect').style.display = 'none';
          document.getElementById('adminLoginForm').style.display = 'block';
        } else if (role === 'doctor') {
          document.getElementById('characterSelect').style.display = 'none';
          document.getElementById('doctorLoginForm').style.display = 'block';
        } else if (role === 'viewer') {
          currentUser = { role: 'viewer', name: 'Observer', icon: 'üëÅ' };
          loginUser();
        }
      });
    });

    document.getElementById('backBtnDoctor').addEventListener('click', () => {
      document.getElementById('characterSelect').style.display = 'grid';
      document.getElementById('doctorLoginForm').style.display = 'none';
      document.getElementById('doctorError').style.display = 'none';
    });

    document.getElementById('backBtnAdmin').addEventListener('click', () => {
      document.getElementById('characterSelect').style.display = 'grid';
      document.getElementById('adminLoginForm').style.display = 'none';
      document.getElementById('adminError').style.display = 'none';
    });

    // Populate doctor dropdown from DOCTORS list
    function populateDoctorSelect() {
      const select = document.getElementById('doctorSelect');
      select.innerHTML = '<option value="">-- Select your name --</option>';
      DOCTORS.forEach((doc, i) => {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = doc.name;
        select.appendChild(option);
      });
    }
    populateDoctorSelect();

    document.getElementById('doctorLoginBtn').addEventListener('click', () => {
      const selectedIndex = document.getElementById('doctorSelect').value;
      const password = document.getElementById('doctorPassword').value;
      if (selectedIndex === '') {
        showNotification('‚ùå Please select your name', 'error');
        return;
      }
      const doctor = DOCTORS[parseInt(selectedIndex)];
      if (password === doctor.password) {
        currentUser = { role: 'doctor', name: doctor.name, icon: '‚öï' };
        document.getElementById('doctorPassword').value = '';
        loginUser();
      } else {
        document.getElementById('doctorError').style.display = 'block';
        showNotification('‚ùå Wrong password', 'error');
      }
    });

    document.getElementById('adminLoginBtn').addEventListener('click', () => {
      const username = document.getElementById('adminUsername').value;
      const password = document.getElementById('adminPassword').value;
      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        currentUser = { role: 'admin', name: 'Administrator', icon: '‚öô' };
        loginUser();
      } else { document.getElementById('adminError').style.display = 'block'; showNotification('‚ùå Access denied', 'error'); }
    });

    function detectLocation() {
      const btn = document.getElementById('detectLocationBtn');
      const info = document.getElementById('locationInfo');
      if (!navigator.geolocation) { showNotification('‚ùå Geolocation not supported', 'error'); return; }
      btn.disabled = true;
      btn.textContent = 'üîÑ Detecting...';
      info.classList.remove('show');
      navigator.geolocation.getCurrentPosition(async (position) => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        document.getElementById('patientLat').value = lat;
        document.getElementById('patientLng').value = lng;
        try {
          const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=10`);
          const data = await response.json();
          const locationName = data.address.city || data.address.town || data.address.village || data.address.county || 'Unknown Location';
          document.getElementById('patientLocation').value = locationName;
          info.innerHTML = `<strong>‚úì Location Detected</strong><br>üìç ${locationName}<br>üåê Coordinates: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
          info.classList.add('show');
          showNotification('‚úì Location detected successfully', 'success');
        } catch (error) {
          document.getElementById('patientLocation').value = `Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`;
          info.innerHTML = `<strong>‚úì GPS Detected</strong><br>üåê ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
          info.classList.add('show');
          showNotification('‚úì GPS coordinates captured', 'success');
        }
        btn.disabled = false;
        btn.textContent = 'üìç Detect My Location';
      }, (error) => {
        btn.disabled = false;
        btn.textContent = 'üìç Detect My Location';
        let message = 'Location detection failed';
        if (error.code === 1) message = '‚ùå Location access denied';
        else if (error.code === 2) message = '‚ùå Location unavailable';
        else if (error.code === 3) message = '‚ùå Location timeout';
        showNotification(message, 'error');
      }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 });
    }

    async function geocodeLocation(locationName) {
      if (!locationName) return null;
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(locationName)},India&limit=1`);
        const data = await response.json();
        if (data && data.length > 0) return { lat: parseFloat(data[0].lat), lng: parseFloat(data[0].lon), displayName: data[0].display_name };
      } catch (error) { console.error('Geocoding error:', error); }
      return null;
    }

    document.getElementById('logoutBtn').addEventListener('click', () => {
      document.getElementById('loginModal').classList.add('active');
      document.getElementById('userBadge').style.display = 'none';
      document.getElementById('adminBtn').style.display = 'none';
      document.getElementById('actionsHeader').style.display = 'none';
      document.getElementById('characterSelect').style.display = 'grid';
      document.getElementById('adminLoginForm').style.display = 'none';
      document.getElementById('doctorLoginForm').style.display = 'none';
      currentUser = null;
      saveToStorage('currentUser', null);
      renderCaseTable();
      showNotification('‚úì Session terminated', 'success');
    });

    document.getElementById('switchRoleBtn').addEventListener('click', () => { document.getElementById('logoutBtn').click(); });

    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => { switchTab(btn.getAttribute('data-tab')); });
    });

    document.querySelectorAll('.symptom-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        btn.classList.toggle('selected');
        const selected = Array.from(document.querySelectorAll('.symptom-btn.selected')).map(b => b.getAttribute('data-symptom'));
        document.getElementById('selectedSymptoms').value = selected.join(', ');
      });
    });

    // =============================================
    // FIX 3: Block observers from submitting cases
    // =============================================
    document.getElementById('reportForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      // BLOCK observers from submitting
      if (!currentUser || currentUser.role === 'viewer') {
        showNotification('‚ùå Observers cannot report cases', 'error');
        return;
      }

      const symptoms = document.getElementById('selectedSymptoms').value;
      if (!symptoms) { showNotification('‚ùå Please select at least one symptom', 'error'); return; }

      const locationName = document.getElementById('patientLocation').value;
      let lat = document.getElementById('patientLat').value;
      let lng = document.getElementById('patientLng').value;
      if (!lat || !lng) {
        const geoData = await geocodeLocation(locationName);
        if (geoData) { lat = geoData.lat; lng = geoData.lng; }
      }

      const newCase = {
        name: document.getElementById('patientName').value,
        age: parseInt(document.getElementById('patientAge').value),
        location: locationName,
        lat: lat ? parseFloat(lat) : null,
        lng: lng ? parseFloat(lng) : null,
        symptoms: symptoms,
        waterSource: document.getElementById('waterSource').value,
        severity: document.getElementById('severity').value,
        date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
        status: 'Active',
        timestamp: new Date().toISOString(),
        synced: isOnline,
        reportedBy: currentUser ? currentUser.name : 'Unknown',
        userId: currentUser ? currentUser.role : null
      };

      if (isOnline) {
        try {
          const savedCase = await createCase(newCase);
          cases.push(savedCase);
          showNotification('‚úì Case reported and saved to database', 'success');
        } catch (error) {
          cases.push(newCase);
          syncQueue.push(newCase);
          saveToStorage('syncQueue', syncQueue);
          saveToStorage('healthCases', cases);
          showNotification('‚ö† Case saved locally (will sync when server available)', 'warning');
        }
      } else {
        cases.push(newCase);
        syncQueue.push(newCase);
        saveToStorage('syncQueue', syncQueue);
        saveToStorage('healthCases', cases);
        showNotification('‚ö† Case saved locally (will sync when online)', 'warning');
      }
      
      updateDashboard(); renderCaseTable(); updateMapMarkers();
      document.getElementById('reportForm').reset();
      document.querySelectorAll('.symptom-btn').forEach(b => b.classList.remove('selected'));
      document.getElementById('locationInfo').classList.remove('show');
      document.getElementById('patientLat').value = '';
      document.getElementById('patientLng').value = '';
      switchTab('dashboard');
    });

    document.querySelectorAll('#caseTableBody tr').forEach(row => row.classList.add('default-case'));

    const savedUser = loadFromStorage('currentUser');
    if (savedUser) {
      currentUser = savedUser;
      document.getElementById('loginModal').classList.remove('active');
      document.getElementById('userBadge').style.display = 'flex';
      document.getElementById('userIcon').textContent = currentUser.icon;
      document.getElementById('userName').textContent = currentUser.name;
      if (currentUser.role === 'admin') {
        document.getElementById('adminBtn').style.display = 'block';
        document.getElementById('actionsHeader').style.display = 'table-cell';
      }
      updateReportTabVisibility();
    }

    (async function initializeApp() {
      const connected = await checkServerConnection();
      if (connected && isOnline) {
        try { await fetchAllCases(); showNotification('‚úì Connected to database', 'success'); }
        catch (error) { cases = loadFromStorage('healthCases') || []; updateDashboard(); renderCaseTable(); updateMapMarkers(); }
      } else {
        cases = loadFromStorage('healthCases') || [];
        updateDashboard(); renderCaseTable(); updateMapMarkers();
      }
    })();

    const savedLang = loadFromStorage('preferredLanguage');
    if (savedLang && translations[savedLang]) currentLanguage = savedLang;
    updateProtocolsDisplay();

    function updateOnlineStatus() {
      isOnline = navigator.onLine;
      const statusEl = document.getElementById('systemStatus');
      const statusDot = document.getElementById('statusDot');
      const statusText = document.getElementById('statusText');
      if (isOnline) {
        statusEl.classList.remove('offline'); statusDot.classList.remove('offline'); statusText.classList.remove('offline');
        statusText.textContent = 'System Online'; syncQueuedData();
      } else {
        statusEl.classList.add('offline'); statusDot.classList.add('offline'); statusText.classList.add('offline');
        statusText.textContent = 'Offline Mode';
      }
    }

    async function syncQueuedData() {
      const queue = loadFromStorage('syncQueue') || [];
      if (queue.length > 0) {
        showNotification(`üîÑ Syncing ${queue.length} pending cases...`, 'info');
        try { await syncQueuedCasesToMongoDB(); } catch (error) { showNotification('‚ö† Sync failed, will retry later', 'warning'); }
      }
    }

    window.addEventListener('online', () => { updateOnlineStatus(); showNotification('‚úì Connection restored', 'success'); });
    window.addEventListener('offline', () => { updateOnlineStatus(); });
    updateOnlineStatus();

    function downloadDashboard() {
      const stats = { totalCases: cases.length, activeCases: cases.filter(c => c.status === 'Active').length, recoveredCases: cases.filter(c => c.status === 'Recovered').length, criticalCases: cases.filter(c => c.severity === 'high').length };
      let content = `AISH HEALTH MONITORING SYSTEM\nGenerated: ${new Date().toLocaleString()}\n${'-'.repeat(60)}\n\nOVERALL STATISTICS\nTotal Cases: ${stats.totalCases}\nActive: ${stats.activeCases}\nRecovered: ${stats.recoveredCases}\nCritical: ${stats.criticalCases}\n\n${'-'.repeat(60)}\nRECENT CASES\n${'-'.repeat(60)}\n`;
      cases.slice(-10).reverse().forEach((c, i) => {
        content += `\n${i + 1}. ${c.name} (Age: ${c.age})\n   Location: ${c.location}\n   Symptoms: ${c.symptoms}\n   Severity: ${c.severity}\n   Status: ${c.status}\n   Date: ${c.date}\n${'-'.repeat(60)}`;
      });
      downloadFile(content, `AISH_Dashboard_Report_${new Date().toISOString().split('T')[0]}.txt`, 'text/plain');
      showNotification('‚úì Dashboard report downloaded', 'success');
    }

    function downloadRegistry() {
      let csv = 'Patient Name,Age,Location,Latitude,Longitude,Symptoms,Water Source,Severity,Date,Status,Synced,Timestamp\n';
      cases.forEach(c => { csv += `"${c.name}","${c.age}","${c.location}","${c.lat || ''}","${c.lng || ''}","${c.symptoms}","${c.waterSource}","${c.severity}","${c.date}","${c.status}","${c.synced ? 'Yes' : 'Pending'}","${c.timestamp || ''}"\n`; });
      downloadFile(csv, `AISH_Case_Registry_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
      showNotification('‚úì Case registry downloaded', 'success');
    }

    function downloadFile(content, filename, mimeType) {
      const blob = new Blob([content], { type: mimeType });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click();
      window.URL.revokeObjectURL(url); document.body.removeChild(a);
    }

    // ========== CHATBOT ==========
    let chatLanguage = 'en';
    const chatKnowledgeBase = {
      en: {
        cholera: { keywords: ['cholera', 'vibrio', 'rice water', 'severe diarrhea'], response: `**Cholera - Key Information:**\n\nüìã Cholera is an acute diarrheal infection caused by Vibrio cholerae bacteria.\n\nüî¨ Symptoms: Severe watery diarrhea, vomiting, rapid dehydration, muscle cramps\n\nüíä Treatment: ORS immediately, IV fluids for severe cases, antibiotics as prescribed\n\nüõ°Ô∏è Prevention: Drink only boiled water, wash hands frequently, cook food thoroughly\n\n‚öïÔ∏è Seek immediate medical help if symptoms appear!` },
        typhoid: { keywords: ['typhoid', 'enteric fever', 'salmonella', 'prolonged fever'], response: `**Typhoid Fever - Essential Guide:**\n\nüìã Typhoid is a bacterial infection caused by Salmonella typhi.\n\nüå°Ô∏è Symptoms: Prolonged high fever, headache, stomach pain, loss of appetite\n\nüíä Treatment: Antibiotics (Ciprofloxacin/Ceftriaxone), rest, adequate nutrition\n\nüõ°Ô∏è Prevention: Typhoid vaccination, safe drinking water, good hygiene\n\nüìû If fever exceeds 104¬∞F, seek immediate medical attention!` },
        prevention: { keywords: ['prevent', 'prevention', 'avoid', 'protect', 'safety'], response: `**Waterborne Disease Prevention Guide:**\n\nüíß Safe Water: Boil for 1 minute, use purification tablets, store in clean covered containers\n\nüßº Hygiene: Wash hands with soap before eating, after toilet use\n\nüç≤ Food Safety: Cook food thoroughly, wash fruits and vegetables\n\nüè• Health: Get vaccinated (Cholera, Typhoid), regular health check-ups\n\n‚úÖ Prevention is always better than cure!` },
        symptoms: { keywords: ['symptom', 'signs', 'feeling', 'sick', 'ill'], response: `**Common Waterborne Disease Symptoms:**\n\nImmediate (0-24 hrs): Nausea, stomach cramps, watery diarrhea, mild fever\n\nModerate (1-3 days): Persistent diarrhea, fever 100-102¬∞F, headache, fatigue\n\nüö® Severe (go to hospital): Bloody diarrhea, high fever over 103¬∞F, severe dehydration, confusion\n\nüíß Dehydration signs: Extreme thirst, dark urine, dizziness, dry mouth\n\nWhen in doubt, always consult a healthcare provider!` },
        emergency: { keywords: ['emergency', 'urgent', 'help', 'serious', 'critical', 'ambulance'], response: `**üö® EMERGENCY CONTACTS:**\n\nüìû Ambulance: 108 / 102\nüìû National Health Helpline: 104 / 1075\nüìû Emergency Services: 112\n\nüö® Call emergency if: unconscious, severe dehydration, fever above 104¬∞F, uncontrolled vomiting\n\n‚öïÔ∏è Early medical intervention saves lives!` },
        water: { keywords: ['water', 'purification', 'clean', 'safe', 'boil'], response: `**Water Purification & Safety Guide:**\n\nüíß Boiling: Most effective ‚Äî boil 1 minute, kills all bacteria and viruses\n\nüíä Chemical: Chlorine tablets or iodine drops ‚Äî wait 30 minutes before drinking\n\nüîß Filtration: Ceramic or activated carbon filters, UV purifiers\n\n‚òÄÔ∏è Solar SODIS: Clear bottles in direct sunlight for 6 hours\n\nüí° When in doubt about water safety, always boil it!` }
      },
      hi: {
        cholera: { keywords: ['‡§π‡•à‡§ú‡§æ', 'cholera', '‡§¶‡§∏‡•ç‡§§', '‡§â‡§≤‡•ç‡§ü‡•Ä'], response: `**‡§π‡•à‡§ú‡§æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä:**\n\n‡§π‡•à‡§ú‡§æ ‡§¶‡•Ç‡§∑‡§ø‡§§ ‡§™‡§æ‡§®‡•Ä ‡§∏‡•á ‡§π‡•ã‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§π‡•à‡•§\n\n‡§≤‡§ï‡•ç‡§∑‡§£: ‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§¶‡§∏‡•ç‡§§, ‡§â‡§≤‡•ç‡§ü‡•Ä, ‡§®‡§ø‡§∞‡•ç‡§ú‡§≤‡•Ä‡§ï‡§∞‡§£\n\n‡§â‡§™‡§ö‡§æ‡§∞: ‡§§‡•Å‡§∞‡§Ç‡§§ ORS ‡§¶‡•á‡§Ç, ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç\n\n‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ: ‡§™‡§æ‡§®‡•Ä ‡§â‡§¨‡§æ‡§≤‡•á‡§Ç, ‡§π‡§æ‡§• ‡§ß‡•ã‡§è‡§Ç\n\n‡§≤‡§ï‡•ç‡§∑‡§£ ‡§¶‡§ø‡§ñ‡§®‡•á ‡§™‡§∞ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§≤‡•á‡§Ç!` },
        prevention: { keywords: ['‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ', '‡§¨‡§ö‡§æ‡§µ', '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ'], response: `**‡§∞‡•ã‡§ó ‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ:**\n\n‡§™‡§æ‡§®‡•Ä: 1 ‡§Æ‡§ø‡§®‡§ü ‡§â‡§¨‡§æ‡§≤‡•á‡§Ç, ‡§∏‡§æ‡§´ ‡§¨‡§∞‡•ç‡§§‡§® ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡•á‡§Ç\n\n‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ‡§§‡§æ: ‡§ñ‡§æ‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§∏‡§æ‡§¨‡•Å‡§® ‡§∏‡•á ‡§π‡§æ‡§• ‡§ß‡•ã‡§è‡§Ç\n\n‡§ñ‡§æ‡§®‡§æ: ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§§‡§∞‡§π ‡§™‡§ï‡§æ‡§è‡§Ç, ‡§´‡§≤ ‡§ß‡•ã‡§è‡§Ç\n\n‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ ‡§á‡§≤‡§æ‡§ú ‡§∏‡•á ‡§¨‡•á‡§π‡§§‡§∞ ‡§π‡•à!` },
        emergency: { keywords: ['‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤', 'emergency', '‡§Æ‡§¶‡§¶'], response: `**‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§®‡§Ç‡§¨‡§∞:**\n\n‡§è‡§Æ‡•ç‡§¨‡•Å‡§≤‡•á‡§Ç‡§∏: 108\n‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§π‡•á‡§≤‡•ç‡§™‡§≤‡§æ‡§á‡§®: 104\n‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤: 112\n\n‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§á‡§≤‡§æ‡§ú ‡§ú‡•Ä‡§µ‡§® ‡§¨‡§ö‡§æ‡§§‡§æ ‡§π‡•à!` }
      },
      ta: {
        cholera: { keywords: ['‡Æï‡Ææ‡Æ≤‡Æ∞‡Ææ', 'cholera', '‡Æµ‡ÆØ‡Æø‡Æ±‡Øç‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Øã‡Æï‡Øç‡Æï‡ØÅ'], response: `**‡Æï‡Ææ‡Æ≤‡Æ∞‡Ææ ‡Æ§‡Æï‡Æµ‡Æ≤‡Øç:**\n\n‡Æï‡Ææ‡Æ≤‡Æ∞‡Ææ ‡ÆÆ‡Ææ‡Æö‡ØÅ‡Æ™‡Æü‡Øç‡Æü ‡Æ®‡ØÄ‡Æ∞‡Æø‡Æ≤‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æ™‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øä‡Æ±‡Øç‡Æ±‡ØÅ.\n\n‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øç: ‡Æï‡Æü‡ØÅ‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æ© ‡Æµ‡ÆØ‡Æø‡Æ±‡Øç‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Øã‡Æï‡Øç‡Æï‡ØÅ, ‡Æµ‡Ææ‡Æ®‡Øç‡Æ§‡Æø\n\n‡Æö‡Æø‡Æï‡Æø‡Æö‡Øç‡Æö‡Øà: ORS, ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡Æ∞‡Øç ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æ©‡Øà\n\n‡ÆÖ‡Æ±‡Æø‡Æï‡ØÅ‡Æ±‡Æø‡Æï‡Æ≥‡Øç ‡Æ§‡Øã‡Æ©‡Øç‡Æ±‡Æø‡Æ©‡Ææ‡Æ≤‡Øç ‡Æâ‡Æü‡Æ©‡Øá ‡ÆÆ‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æµ‡Æ∞‡Øà ‡Æ™‡Ææ‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç!` },
        prevention: { keywords: ['‡Æ§‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ', '‡Æ™‡Ææ‡Æ§‡ØÅ‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡ØÅ'], response: `**‡Æ®‡Øã‡ÆØ‡Øç ‡Æ§‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ:**\n\n‡Æ®‡ØÄ‡Æ∞‡Øç: 1 ‡Æ®‡Æø‡ÆÆ‡Æø‡Æü‡ÆÆ‡Øç ‡Æï‡Øä‡Æ§‡Æø‡Æï‡Øç‡Æï‡Æµ‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç\n‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞‡ÆÆ‡Øç: ‡Æö‡Ææ‡Æ™‡Øç‡Æ™‡Æø‡Æü ‡ÆÆ‡ØÅ‡Æ©‡Øç ‡Æï‡Øà‡Æï‡Æ≥‡Øà ‡Æï‡Æ¥‡ØÅ‡Æµ‡Æµ‡ØÅ‡ÆÆ‡Øç\n‡Æ§‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ ‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øç ‡Æö‡Æø‡Æï‡Æø‡Æö‡Øç‡Æö‡Øà‡ÆØ‡Øà ‡Æµ‡Æø‡Æü ‡Æö‡Æø‡Æ±‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ!` },
        emergency: { keywords: ['‡ÆÖ‡Æµ‡Æö‡Æ∞‡ÆÆ‡Øç', 'emergency'], response: `**‡ÆÖ‡Æµ‡Æö‡Æ∞ ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç:**\n\n‡ÆÜ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æ≤‡Æ©‡Øç‡Æ∏‡Øç: 108\n‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞ ‡Æâ‡Æ§‡Æµ‡Æø: 104\n‡ÆÜ‡Æ™‡Æ§‡Øç‡Æ§‡ØÅ: 112` }
      },
      te: {
        cholera: { keywords: ['‡∞ï‡∞≤‡∞∞‡∞æ', 'cholera'], response: `**‡∞ï‡∞≤‡∞∞‡∞æ ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç:**\n\n‡∞ï‡∞≤‡∞∞‡∞æ ‡∞ï‡∞≤‡±Å‡∞∑‡∞ø‡∞§‡∞Æ‡±à‡∞® ‡∞®‡±Ä‡∞ü‡∞ø ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞µ‡±ç‡∞Ø‡∞æ‡∞™‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.\n\n‡∞≤‡∞ï‡±ç‡∞∑‡∞£‡∞æ‡∞≤‡±Å: ‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞Æ‡±à‡∞® ‡∞µ‡∞ø‡∞∞‡±á‡∞ö‡∞®‡∞æ‡∞≤‡±Å, ‡∞µ‡∞æ‡∞Ç‡∞§‡±Å‡∞≤‡±Å\n\n‡∞ö‡∞ø‡∞ï‡∞ø‡∞§‡±ç‡∞∏: ‡∞µ‡±Ü‡∞Ç‡∞ü‡∞®‡±á ORS, ‡∞µ‡±à‡∞¶‡±ç‡∞Ø‡±Å‡∞°‡∞ø‡∞®‡∞ø ‡∞∏‡∞Ç‡∞™‡±ç‡∞∞‡∞¶‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø\n\n‡∞≤‡∞ï‡±ç‡∞∑‡∞£‡∞æ‡∞≤‡±Å ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞∏‡±ç‡∞§‡±á ‡∞µ‡±Ü‡∞Ç‡∞ü‡∞®‡±á ‡∞µ‡±à‡∞¶‡±ç‡∞Ø‡±Å‡∞°‡∞ø‡∞®‡∞ø ‡∞∏‡∞Ç‡∞¶‡∞∞‡±ç‡∞∂‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø!` },
        prevention: { keywords: ['‡∞®‡∞ø‡∞µ‡∞æ‡∞∞‡∞£', '‡∞∞‡∞ï‡±ç‡∞∑‡∞£'], response: `**‡∞®‡∞ø‡∞µ‡∞æ‡∞∞‡∞£ ‡∞ö‡∞∞‡±ç‡∞Ø‡∞≤‡±Å:**\n\n‡∞®‡±Ä‡∞∞‡±Å: 1 ‡∞®‡∞ø‡∞Æ‡∞ø‡∞∑‡∞Ç ‡∞â‡∞°‡∞ø‡∞ï‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø\n‡∞™‡∞∞‡∞ø‡∞∂‡±Å‡∞≠‡±ç‡∞∞‡∞§: ‡∞§‡∞ø‡∞®‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å ‡∞ö‡±á‡∞§‡±Å‡∞≤‡±Å ‡∞ï‡∞°‡±Å‡∞ï‡±ç‡∞ï‡±ã‡∞Ç‡∞°‡∞ø\n‡∞®‡∞ø‡∞µ‡∞æ‡∞∞‡∞£ ‡∞ö‡∞ø‡∞ï‡∞ø‡∞§‡±ç‡∞∏ ‡∞ï‡∞Ç‡∞ü‡±á ‡∞Æ‡∞Ç‡∞ö‡∞ø‡∞¶‡∞ø!` },
        emergency: { keywords: ['‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞‡∞Ç', 'emergency'], response: `**‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞ ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç‡∞≤‡±Å:**\n\n‡∞Ü‡∞Ç‡∞¨‡±Å‡∞≤‡±Ü‡∞®‡±ç‡∞∏‡±ç: 108\n‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø ‡∞π‡±Ü‡∞≤‡±ç‡∞™‡±ç‚Äå‡∞≤‡±à‡∞®‡±ç: 104\n‡∞é‡∞Æ‡∞∞‡±ç‡∞ú‡±Ü‡∞®‡±ç‡∞∏‡±Ä: 112` }
      },
      bn: {
        cholera: { keywords: ['‡¶ï‡¶≤‡ßá‡¶∞‡¶æ', 'cholera', '‡¶°‡¶æ‡¶Ø‡¶º‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ'], response: `**‡¶ï‡¶≤‡ßá‡¶∞‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø:**\n\n‡¶ï‡¶≤‡ßá‡¶∞‡¶æ ‡¶¶‡ßÇ‡¶∑‡¶ø‡¶§ ‡¶™‡¶æ‡¶®‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶õ‡¶°‡¶º‡¶æ‡¶Ø‡¶º‡•§\n\n‡¶≤‡¶ï‡ßç‡¶∑‡¶£: ‡¶§‡ßÄ‡¶¨‡ßç‡¶∞ ‡¶°‡¶æ‡¶Ø‡¶º‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ, ‡¶¨‡¶Æ‡¶ø\n\n‡¶ö‡¶ø‡¶ï‡¶ø‡ßé‡¶∏‡¶æ: ORS ‡¶¶‡¶ø‡¶®, ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®\n\n‡¶≤‡¶ï‡ßç‡¶∑‡¶£ ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶¶‡¶ø‡¶≤‡ßá ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶ö‡¶ø‡¶ï‡¶ø‡ßé‡¶∏‡¶æ ‡¶®‡¶ø‡¶®!` },
        prevention: { keywords: ['‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∞‡ßã‡¶ß', '‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ'], response: `**‡¶∞‡ßã‡¶ó ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∞‡ßã‡¶ß:**\n\n‡¶™‡¶æ‡¶®‡¶ø: ‡ßß ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶´‡ßã‡¶ü‡¶æ‡¶®\n‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø‡¶¨‡¶ø‡¶ß‡¶ø: ‡¶ñ‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶π‡¶æ‡¶§ ‡¶ß‡ßÅ‡¶Ø‡¶º‡ßá ‡¶®‡¶ø‡¶®\n‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∞‡ßã‡¶ß ‡¶∏‡¶¨‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶ö‡¶ø‡¶ï‡¶ø‡ßé‡¶∏‡¶æ‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶≠‡¶æ‡¶≤‡ßã!` },
        emergency: { keywords: ['‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø', 'emergency', '‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø'], response: `**‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó:**\n\n‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡ßç‡¶¨‡ßÅ‡¶≤‡ßá‡¶®‡ßç‡¶∏: 108\n‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶π‡ßá‡¶≤‡ßç‡¶™‡¶≤‡¶æ‡¶á‡¶®: 104\n‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶∏‡ßá‡¶¨‡¶æ: 112` }
      }
    };

    function setChatLanguage(lang) {
      chatLanguage = lang;
      document.querySelectorAll('.language-btn[id^="chatLang"]').forEach(btn => btn.classList.remove('active'));
      document.getElementById(`chatLang${lang.charAt(0).toUpperCase() + lang.slice(1)}`).classList.add('active');
      showNotification(`Language changed to ${lang.toUpperCase()}`, 'success');
    }
    window.setChatLanguage = setChatLanguage;

    function sendChatMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      if (!message) return;
      addChatMessage(message, 'user');
      input.value = '';
      const chatMessages = document.getElementById('chatMessages');
      const thinkingDiv = document.createElement('div');
      thinkingDiv.className = 'bot-message';
      thinkingDiv.id = 'thinkingMessage';
      thinkingDiv.innerHTML = `<div style="font-weight: 600; color: #3498db; margin-bottom: 8px; font-size: 13px;">ü§ñ AISH Assistant</div><div style="color: #2c3e50; font-size: 14px;">Analyzing<span class="ai-thinking"><span></span><span></span><span></span></span></div>`;
      chatMessages.appendChild(thinkingDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      setTimeout(() => { thinkingDiv.remove(); addChatMessage(processUserMessage(message), 'bot'); }, 1500);
    }
    window.sendChatMessage = sendChatMessage;

    function askQuickQuestion(question) { document.getElementById('chatInput').value = question; sendChatMessage(); }
    window.askQuickQuestion = askQuickQuestion;

    function processUserMessage(message) {
      const lowerMessage = message.toLowerCase();
      const kb = chatKnowledgeBase[chatLanguage] || chatKnowledgeBase.en;
      for (const [topic, data] of Object.entries(kb)) {
        if (data.keywords.some(keyword => lowerMessage.includes(keyword.toLowerCase()))) return data.response;
      }
      const defaults = {
        en: `I can help with: Cholera, Typhoid, Prevention, Symptoms, Treatment, Emergency contacts, Water safety.\n\nPlease ask about any of these topics!`,
        hi: `‡§Æ‡•à‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç: ‡§π‡•à‡§ú‡§æ, ‡§ü‡§æ‡§á‡§´‡§æ‡§á‡§°, ‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ, ‡§≤‡§ï‡•ç‡§∑‡§£, ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•§\n\n‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§® ‡§µ‡§ø‡§∑‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ‡•á‡§Ç!`,
        ta: `‡Æ®‡Ææ‡Æ©‡Øç ‡Æâ‡Æ§‡Æµ ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç: ‡Æï‡Ææ‡Æ≤‡Æ∞‡Ææ, ‡Æ§‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ, ‡ÆÖ‡Æµ‡Æö‡Æ∞‡ÆÆ‡Øç.\n\n‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æï‡Øá‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç!`,
        te: `‡∞®‡±á‡∞®‡±Å ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡±Å: ‡∞ï‡∞≤‡∞∞‡∞æ, ‡∞®‡∞ø‡∞µ‡∞æ‡∞∞‡∞£, ‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞‡∞Ç.\n\n‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Ö‡∞°‡∞ó‡∞Ç‡∞°‡∞ø!`,
        bn: `‡¶Ü‡¶Æ‡¶ø ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø: ‡¶ï‡¶≤‡ßá‡¶∞‡¶æ, ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∞‡ßã‡¶ß, ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶™‡¶∞‡¶ø‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø‡•§\n\n‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®!`
      };
      return defaults[chatLanguage] || defaults.en;
    }

    function addChatMessage(message, type) {
      const chatMessages = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat-message ${type}-message`;
      if (type === 'bot') {
        messageDiv.innerHTML = `<div style="font-weight: 600; color: #3498db; margin-bottom: 8px; font-size: 13px;">ü§ñ AISH Assistant</div><div style="color: #2c3e50; font-size: 14px; line-height: 1.6; white-space: pre-line;">${message}</div>`;
      } else {
        messageDiv.innerHTML = `<div style="font-weight: 600; color: #2196f3; margin-bottom: 8px; font-size: 13px;">You</div><div style="color: #2c3e50; font-size: 14px; line-height: 1.6;">${message}</div>`;
      }
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function toggleChatbot() {
      document.getElementById('chatbotPopup').classList.toggle('active');
      document.getElementById('chatbotToggle').classList.toggle('active');
    }
    window.toggleChatbot = toggleChatbot;

    syncQueue = loadFromStorage('syncQueue') || [];

    // =============================================
    // KEEP RENDER SERVER AWAKE (ping every 10 mins)
    // =============================================
    function pingServer() {
      fetch(`${API_URL}/health`)
        .then(() => console.log('‚úì Server is awake'))
        .catch(() => console.log('‚ö† Server sleeping, waking up...'));
    }
    // Ping immediately when page loads, then every 10 minutes
    pingServer();
    setInterval(pingServer, 10 * 60 * 1000);
  </script>
</body>
</html>
